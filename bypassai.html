<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prysmis - Your Ultimate AI Coding & Learning Partner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.24.1/themes/prism-tomorrow.css" rel="stylesheet">
    <style>
body {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    min-height: 100vh;
    margin: 0;
    font-family: 'Inter', sans-serif;
    color: #e2e8f0;
    overflow-x: hidden;
    overflow-y: auto;
    transition: background 0.7s ease;
}

body.light-mode {
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    color: #1f2937;
}

.app-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 2.5rem;
}

.glass-card {
    background: rgba(30, 41, 59, 0.92);
    backdrop-filter: blur(16px);
    border-radius: 22px;
    box-shadow: 0 16px 45px rgba(0, 0, 0, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.35);
    overflow: hidden;
    transition: transform 0.5s ease, box-shadow 0.5s ease;
}

body.light-mode .glass-card {
    background: rgba(255, 255, 255, 0.96);
    border: 1px solid rgba(0, 0, 0, 0.18);
    box-shadow: 0 16px 45px rgba(0, 0, 0, 0.25);
}

.glass-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 22px 55px rgba(139, 92, 246, 0.85);
}

.section-tabs {
    display: flex;
    gap: 1.2rem;
    margin-bottom: 1.8rem;
    flex-wrap: wrap;
    justify-content: center;
}

.tab {
    padding: 0.9rem 1.8rem;
    background: rgba(255, 255, 255, 0.32);
    border-radius: 16px;
    font-size: 1.15rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.45s ease;
    box-shadow: 0 7px 18px rgba(0, 0, 0, 0.35);
}

body.light-mode .tab {
    background: rgba(0, 0, 0, 0.12);
}

.tab.active {
    background: #8b5cf6;
    box-shadow: 0 9px 22px rgba(139, 92, 246, 1);
    transform: scale(1.09);
}

.tab:hover:not(.active) {
    background: rgba(255, 255, 255, 0.55);
    transform: scale(1.05);
}

.language-selector {
    display: flex;
    gap: 0.9rem;
    margin-bottom: 1.8rem;
    flex-wrap: wrap;
    justify-content: center;
}

.language-option {
    padding: 0.9rem 1.8rem;
    background: rgba(255, 0, 0, 0.32);
    border-radius: 9999px;
    font-size: 1.05rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.45s ease;
    box-shadow: 0 7px 18px rgba(0, 0, 0, 0.35);
    border: 1px solid rgba(255, 0, 0, 0.65);
}

.language-option.active {
    background: rgba(255, 0, 0, 0.95);
    transform: scale(1.09);
    box-shadow: 0 9px 22px rgba(255, 0, 0, 1);
}

.language-option:hover {
    background: rgba(255, 0, 0, 0.55);
    transform: scale(1.05);
}

body.light-mode .language-option {
    background: rgba(255, 0, 0, 0.22);
}

body.light-mode .language-option.active {
    background: rgba(255, 0, 0, 0.85);
}

body.light-mode .language-option:hover {
    background: rgba(255, 0, 0, 0.45);
}

.editor-container, .general-container, .homework-container, .analysis-container {
    display: none;
    grid-template-columns: 1fr;
    gap: 1.8rem;
    background: rgba(15, 23, 42, 0.75);
    border-radius: 22px;
    padding: 1.8rem;
    opacity: 0;
    transition: all 0.75s ease;
}

body.light-mode .editor-container, body.light-mode .general-container, body.light-mode .homework-container, body.light-mode .analysis-container {
    background: rgba(229, 231, 235, 0.75);
}

.editor-container.active, .general-container.active, .homework-container.active, .analysis-container.active {
    display: grid;
    opacity: 1;
}

.code-area, .general-area, .homework-area, .analysis-area {
    position: relative;
    height: 320px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 14px 35px rgba(0, 0, 0, 0.45);
    background: #1e1e1e;
    transition: transform 0.45s ease, opacity 0.45s ease;
}

body.light-mode .code-area, body.light-mode .general-area, body.light-mode .homework-area, body.light-mode .analysis-area {
    background: #f1f5f9;
}

.code-area.active-response {
    animation: responseFade 1s ease-in-out, responseGlow 1.9s infinite alternate;
}

@keyframes responseFade {
    0% { opacity: 0; transform: translateY(15px); }
    100% { opacity: 1; transform: translateY(0); }
}

@keyframes responseGlow {
    from { box-shadow: 0 0 18px #8b5cf6; }
    to { box-shadow: 0 0 35px #a78bfa, 0 0 45px #c4b5fd; }
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.2rem;
    background: linear-gradient(90deg, #1a1a3a, #2a2a5a);
    border-radius: 20px 20px 0 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.45);
}

body.light-mode .code-header {
    background: linear-gradient(90deg, #e5e7eb, #d1d5db);
}

.code-textarea, .general-textarea, .homework-textarea, .analysis-textarea {
    width: 100%;
    height: calc(100% - 52px);
    padding: 1.2rem;
    border: none;
    background: transparent;
    color: #e5e7eb;
    font-family: 'Fira Code', monospace;
    font-size: 1rem;
    line-height: 1.9;
    resize: none;
    outline: none;
    scrollbar-width: thin;
    scrollbar-color: #8b5cf6 rgba(255, 255, 255, 0.45);
}

body.light-mode .code-textarea, body.light-mode .general-textarea, body.light-mode .homework-textarea, body.light-mode .analysis-textarea {
    color: #1f2937;
}

#codeOutput, #generalOutput, #homeworkOutput, #analysisOutput {
    white-space: pre-wrap;
    overflow-y: auto;
    padding: 1.2rem;
}

.btn-primary {
    background: #8b5cf6;
    color: white;
    border: none;
    border-radius: 16px;
    padding: 0.9rem 1.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.45s ease;
    display: flex;
    align-items: center;
    gap: 0.7rem;
    box-shadow: 0 9px 22px rgba(139, 92, 246, 0.65);
}

.btn-primary:hover {
    background: #7c3aed;
    transform: translateY(-6px);
    box-shadow: 0 14px 35px rgba(139, 92, 246, 0.95);
}

.feature-button {
    background: rgba(255, 255, 255, 0.32);
    border: none;
    border-radius: 14px;
    padding: 0.7rem;
    color: #e2e8f0;
    cursor: pointer;
    transition: all 0.45s ease;
}

body.light-mode .feature-button {
    background: rgba(0, 0, 0, 0.12);
}

.status-badge {
    background: rgba(6, 182, 212, 0.45);
    color: #06b6d4;
    padding: 0.7rem 1.4rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.7rem;
    transition: all 0.45s ease;
}

.status-badge.inactive {
    background: rgba(239, 68, 68, 0.45);
    color: #ef4444;
}

.status-badge.inactive .pulsing-dot {
    background-color: #ef4444;
    animation: pulseRed 0.95s infinite;
}

.pulsing-dot {
    width: 11px;
    height: 11px;
    background-color: #06b6d4;
    border-radius: 50%;
    animation: pulse 0.95s infinite;
}

@keyframes pulse {
    0% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.95); }
    70% { transform: scale(1.25); box-shadow: 0 0 0 14px rgba(6, 182, 212, 0); }
    100% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(6, 182, 212, 0); }
}

@keyframes pulseRed {
    0% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.95); }
    70% { transform: scale(1.25); box-shadow: 0 0 0 14px rgba(239, 68, 68, 0); }
    100% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
}

.model-selector {
    display: flex;
    gap: 0.9rem;
    margin-bottom: 1.8rem;
    flex-wrap: wrap;
    justify-content: center;
}

.model-option {
    padding: 0.9rem 1.8rem;
    background: rgba(255, 255, 255, 0.32);
    border-radius: 9999px;
    font-size: 1.05rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.45s ease;
    box-shadow: 0 7px 18px rgba(0, 0, 0, 0.35);
}

.model-option.active {
    background: #8b5cf6;
    transform: scale(1.09);
}

.model-option:hover {
    background: rgba(255, 255, 255, 0.55);
    transform: scale(1.05);
}

body.light-mode .model-option {
    background: rgba(0, 0, 0, 0.12);
}

body.light-mode .model-option.active {
    background: #9333ea;
}

body.light-mode .model-option:hover {
    background: rgba(0, 0, 0, 0.18);
}

.theme-toggle-btn, .profile-btn {
    background: rgba(255, 255, 255, 0.32);
    color: #e2e8f0;
    padding: 0.7rem 1.4rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.7rem;
    cursor: pointer;
    transition: all 0.45s ease;
}

body.light-mode .theme-toggle-btn, body.light-mode .profile-btn {
    background: rgba(0, 0, 0, 0.12);
}

.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1.2rem;
    margin-bottom: 2.2rem;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 0.7rem;
}

.slogan {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    color: #e2e8f0;
    margin-bottom: 2.2rem;
    background: linear-gradient(90deg, #8b5cf6, #7c3aed);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.progress-bar {
    width: 100%;
    height: 9px;
    background: rgba(255, 255, 255, 0.35);
    border-radius: 5px;
    overflow: hidden;
    margin-top: 0.9rem;
    display: none;
}

.progress-bar.active {
    display: block;
}

.progress-bar-fill {
    width: 0;
    height: 100%;
    background: #8b5cf6;
    transition: width 0.045s linear;
}

.retry-btn {
    background: rgba(234, 88, 12, 0.45);
    color: #ea580c;
    padding: 0.7rem 1.4rem;
    border-radius: 9999px;
    display: none;
    align-items: center;
    gap: 0.7rem;
    cursor: pointer;
    transition: all 0.45s ease;
}

.copy-btn {
    background: #06b6d4;
    color: white;
    border: none;
    border-radius: 16px;
    padding: 0.7rem 1.4rem;
    cursor: pointer;
    margin-top: 0.9rem;
    transition: background 0.45s;
}

.copy-btn:hover {
    background: #0891b2;
}

.continue-btn {
    background: #8b5cf6;
    color: white;
    border: none;
    border-radius: 16px;
    padding: 0.7rem 1.4rem;
    cursor: pointer;
    margin-top: 0.9rem;
    transition: background 0.45s;
}

.continue-btn:hover {
    background: #7c3aed;
}

.ai-to-human-btn {
    background: #f59e0b;
    color: white;
    border: none;
    border-radius: 16px;
    padding: 0.7rem 1.4rem;
    cursor: pointer;
    margin-top: 0.9rem;
    transition: background 0.45s;
}

.ai-to-human-btn:hover {
    background: #d97706;
}

.profile-modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(30, 41, 59, 0.96);
    padding: 2.2rem;
    border-radius: 22px;
    box-shadow: 0 14px 40px rgba(0, 0, 0, 0.55);
    z-index: 1000;
    color: #e2e8f0;
    width: 420px;
    max-height: 90vh;
    overflow-y: auto;
}

body.light-mode .profile-modal {
    background: rgba(255, 255, 255, 0.96);
    color: #1f2937;
}

.profile-modal.active {
    display: block;
}

.close-btn {
    position: absolute;
    top: 0.7rem;
    right: 0.7rem;
    background: none;
    border: none;
    color: #e2e8f0;
    font-size: 1.5rem;
    cursor: pointer;
    transition: color 0.45s;
}

body.light-mode .close-btn {
    color: #1f2937;
}

.close-btn:hover {
    color: #8b5cf6;
}

.api-key-input, .custom-instruction {
    margin: 1.4rem 0;
}

select, input[type="text"], textarea {
    padding: 0.8rem;
    border-radius: 14px;
    border: 1px solid rgba(107, 114, 128, 0.45);
    width: 100%;
    background: #1e1e1e;
    color: #e2e8f0;
    font-size: 1.15rem;
    transition: border-color 0.45s ease, background 0.45s ease;
}

body.light-mode select, body.light-mode input[type="text"], body.light-mode textarea {
    background: #f1f5f9;
    color: #1f2937;
    border-color: rgba(107, 114, 128, 0.35);
}

select:focus, input[type="text"]:focus, textarea:focus {
    border-color: #8b5cf6;
    outline: none;
    background: #2a2a5a;
}

body.light-mode select:focus, body.light-mode input[type="text"]:focus, body.light-mode textarea:focus {
    background: #e5e7eb;
}

button.save-btn {
    background: #8b5cf6;
    color: white;
    border: none;
    border-radius: 14px;
    padding: 0.8rem 1.6rem;
    cursor: pointer;
    transition: background 0.45s;
    width: 100%;
    margin-top: 1.2rem;
    font-weight: 600;
}

button.save-btn:hover {
    background: #7c3aed;
}
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header-container">
            <div class="header-left">
                <div class="text-purple-600 text-3xl sm:text-4xl">
                    <i class="fas fa-code"></i>
                </div>
                <div>
                    <-propan class="text-2xl sm:text-3xl font-bold">Prysmis AI</h1>
                    <p class="text-gray-400 text-sm sm:text-base" id="welcomeText"></p>
                </div>
            </div>
            <div class="header-right">
                <div class="status-badge" id="statusBadge">
                    <span class="pulsing-dot"></span>
                    <span id="statusText">API Active</span>
                </div>
                <div id="themeToggleBtn" class="theme-toggle-btn">
                    <i class="fas fa-moon"></i>
                    <span>Toggle Theme</span>
                </div>
                <button id="profileBtn" class="profile-btn">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </button>
                <button id="signOutBtn" class="theme-toggle-btn" style="background: rgba(255, 0, 0, 0.32);">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sign Out</span>
                </button>
                <button id="adminPanelBtn" class="theme-toggle-btn" style="background: rgba(0, 255, 0, 0.32); display: none;">
                    <i class="fas fa-user-shield"></i>
                    <span>Admin Panel</span>
                </button>
            </div>
        </header>

        <div class="slogan">Prysmis - Your Ultimate AI Coding & Learning Partner</div>

        <div class="section-tabs">
            <div class="tab active" data-section="coding">Code Processing</div>
            <div class="tab" data-section="general">General Query</div>
            <div class="tab" data-section="homework">Homework Solver</div>
            <div class="tab" data-section="analysis">Code Analysis</div>
        </div>

        <div class="language-selector" id="languageSelector">
            <div class="language-option active" data-lang="javascript">JavaScript</div>
            <div class="language-option" data-lang="python">Python</div>
            <div class="language-option" data-lang="lua">Lua</div>
            <div class="language-option" data-lang="ruby">Ruby</div>
            <div class="language-option" data-lang="go">Go</div>
            <div class="language-option" data-lang="cpp">C++</div>
            <div class="language-option" data-lang="csharp">C#</div>
            <div class="language-option" data-lang="java">Java</div>
        </div>

        <div class="model-selector" id="modelSelector">
            <div class="model-option active" data-model="chatgpt">ChatGPT</div>
            <div class="model-option" data-model="deepseek">DeepSeek</div>
        </div>

        <div class="glass-card mb-5">
            <div class="p-3 sm:p-4">
                <h2 class="text-xl sm:text-2xl font-semibold mb-2" id="sectionTitle">Code Processing</h2>
                <p class="text-sm sm:text-base text-gray-400" id="sectionDescription">Input code or URL for superior processing with precision optimization.</p>
            </div>

            <div class="editor-container active" id="codingSection">
                <div class="code-area">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Input Code</span>
                        <div class="flex gap-1 sm:gap-2">
                            <button class="feature-button clear-btn"><i class="fas fa-trash-alt"></i></button>
                            <button class="feature-button copy-input-btn"><i class="fas fa-copy"></i></button>
                        </div>
                    </div>
                    <textarea id="codeInput" class="code-textarea" placeholder="Enter code or URL..."></textarea>
                </div>
                <div class="code-area majestic-response">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Result</span>
                        <div class="flex gap-1 sm:gap-2 flex-wrap">
                            <button class="feature-button copy-output-btn"><i class="fas fa-copy"></i></button>
                            <button class="feature-button download-btn"><i class="fas fa-download"></i></button>
                            <button class="copy-btn" id="copyCodeBtn">Copy Code</button>
                            <button class="continue-btn" id="continueBtn" style="display: none;">Continue Code</button>
                        </div>
                    </div>
                    <div id="codeOutput" class="code-textarea"></div>
                    <div class="progress-bar" id="codeProgressBar">
                        <div class="progress-bar-fill" id="codeProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryCodeBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>

            <div class="general-container" id="generalSection">
                <div class="general-area">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Input Query</span>
                        <div class="flex gap-1 sm:gap-2">
                            <button class="feature-button clear-general-btn"><i class="fas fa-trash-alt"></i></button>
                            <button class="feature-button copy-general-input-btn"><i class="fas fa-copy"></i></button>
                        </div>
                    </div>
                    <textarea id="generalInput" class="general-textarea" placeholder="Ask anything..."></textarea>
                </div>
                <div class="general-area">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Response</span>
                        <div class="flex gap-1 sm:gap-2">
                            <button class="feature-button copy-general-output-btn"><i class="fas fa-copy"></i></button>
                            <button class="feature-button download-general-btn"><i class="fas fa-download"></i></button>
                        </div>
                    </div>
                    <div id="generalOutput" class="general-textarea">Responses will appear here...</div>
                    <div class="progress-bar" id="generalProgressBar">
                        <div class="progress-bar-fill" id="generalProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryGeneralBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>

            <div class="homework-container" id="homeworkSection">
                <div class="homework-area">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Input Problem</span>
                        <div class="flex gap-1 sm:gap-2">
                            <button class="feature-button clear-homework-btn"><i class="fas fa-trash-alt"></i></button>
                            <button class="feature-button copy-homework-input-btn"><i class="fas fa-copy"></i></button>
                        </div>
                    </div>
                    <textarea id="homeworkInput" class="homework-textarea" placeholder="Enter problem or question..."></textarea>
                </div>
                <div class="homework-area">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Solution</span>
                        <div class="flex gap-1 sm:gap-2">
                            <button class="feature-button copy-homework-output-btn"><i class="fas fa-copy"></i></button>
                            <button class="feature-button download-homework-btn"><i class="fas fa-download"></i></button>
                        </div>
                    </div>
                    <div id="homeworkOutput" class="homework-textarea"></div>
                    <div class="progress-bar" id="homeworkProgressBar">
                        <div class="progress-bar-fill" id="homeworkProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryHomeworkBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>

            <div class="analysis-container" id="analysisSection">
                <div class="analysis-area">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Input Code</span>
                        <div class="flex gap-1 sm:gap-2">
                            <button class="feature-button clear-analysis-btn"><i class="fas fa-trash-alt"></i></button>
                            <button class="feature-button copy-analysis-input-btn"><i class="fas fa-copy"></i></button>
                        </div>
                    </div>
                    <textarea id="analysisInput" class="analysis-textarea" placeholder="Enter code for analysis..."></textarea>
                </div>
                <div class="analysis-area majestic-response">
                    <div class="code-header">
                        <span class="text-sm sm:text-base font-medium">Analysis Report</span>
                        <div class="flex gap-1 sm:gap-2 flex-wrap">
                            <button class="feature-button copy-analysis-output-btn"><i class="fas fa-copy"></i></button>
                            <button class="feature-button download-analysis-btn"><i class="fas fa-download"></i></button>
                            <button class="ai-to-human-btn" id="aiToHumanBtn">AI to Human</button>
                        </div>
                    </div>
                    <div id="analysisOutput" class="analysis-textarea">Analysis will appear here...</div>
                    <div class="progress-bar" id="analysisProgressBar">
                        <div class="progress-bar-fill" id="analysisProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryAnalysisBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>

            <div class="button-group flex justify-center gap-1 flex-wrap p-3 sm:p-4">
                <button class="btn-primary" id="processBtn" style="display: flex;">
                    <i class="fas fa-magic"></i><span>Optimize</span>
                </button>
                <button class="btn-primary" id="debugBtn" style="display: flex;">
                    <i class="fas fa-bug"></i><span>Debug</span>
                </button>
                <button class="btn-primary" id="explainBtn" style="display: flex;">
                    <i class="fas fa-info-circle"></i><span>Explain</span>
                </button>
                <button class="btn-primary" id="obfuscateBtn" style="display: flex;">
                    <i class="fas fa-lock"></i><span>Obfuscate</span>
                </button>
                <button class="btn-primary" id="deobfuscateBtn" style="display: flex;">
                    <i class="fas fa-unlock"></i><span>Deobfuscate</span>
                </button>
                <button class="btn-primary" id="improveBtn" style="display: flex;">
                    <i class="fas fa-wrench"></i><span>Improve</span>
                </button>
                <button class="btn-primary" id="generalBtn" style="display: none;">
                    <i class="fas fa-question-circle"></i><span>Query</span>
                </button>
                <button class="btn-primary" id="homeworkBtn" style="display: none;">
                    <i class="fas fa-book"></i><span>Solve</span>
                </button>
                <button class="btn-primary" id="analyzeBtn" style="display: none;">
                    <i class="fas fa-chart-bar"></i><span>Analyze</span>
                </button>
            </div>
        </div>
    </div>

    <div class="profile-modal" id="profileModal">
        <button class="close-btn" id="closeProfileBtn">×</button>
        <h2 class="text-xl sm:text-2xl font-semibold mb-4">Profile Settings</h2>
        <div class="api-key-input" id="apiKeyInput">
            <label class="block text-base mb-2">API AI Model Key:</label>
            <input type="text" id="chatGptApiKey" placeholder="Enter API Key for ChatGPT" class="appearance-none bg-black text-white border-none rounded-md p-2.5 w-full focus:ring-2 focus:ring-purple-500 mb-2">
            <input type="text" id="deepSeekApiKey" placeholder="Enter API Key for DeepSeek" class="appearance-none bg-black text-white border-none rounded-md p-2.5 w-full focus:ring-2 focus:ring-purple-500">
        </div>
        <div class="custom-instruction">
            <label for="customInstruction" class="block text-base mb-2">How should Prysmis AI behave?</label>
            <textarea id="customInstruction" placeholder="Enter custom instructions for all AI models..." class="appearance-none bg-black text-white border-none rounded-md p-2.5 w-full focus:ring-2 focus:ring-purple-500" rows="4"></textarea>
        </div>
        <button class="save-btn mt-4" id="saveApiKeyBtn">Save</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.24.1/prism.min.js"></script>
    <script>
if (!localStorage.getItem('username')) {
    window.location.href = 'index.html';
}

const username = localStorage.getItem('username');
document.getElementById('welcomeText').textContent = `Welcome, ${username}${username === 'realalex' ? ' [Admin]' : ''} | Coding & Learning Assistant`;
if (username === 'realalex') document.getElementById('adminPanelBtn').style.display = 'inline-flex';

async function validateDeepSeekApiKey(key) {
    if (!key) return false;
    try {
        const response = await fetch('https://api.deepseek.com/v1/models', {
            headers: { 'Authorization': `Bearer ${key}` }
        });
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`DeepSeek validation failed: ${response.status} - ${errorText}`);
        }
        return true;
    } catch (error) {
        throw new Error(error.message);
    }
}

async function validateChatGptApiKey(key) {
    if (!key) return false;
    try {
        const response = await fetch('https://api.openai.com/v1/models', {
            headers: { 'Authorization': `Bearer ${key}` }
        });
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`ChatGPT validation failed: ${response.status} - ${errorText}`);
        }
        return true;
    } catch (error) {
        throw new Error(error.message);
    }
}

async function callChatGpt(prompt, maxTokens = 4000, apiKey = localStorage.getItem('chatGptApiKey')) {
    if (!apiKey) return 'ChatGPT API key missing. Please add it in profile settings.';
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: 'gpt-4o',
                messages: [
                    { role: 'system', content: localStorage.getItem('customInstruction') || 'Act as an expert coding assistant providing precise, clear, and actionable advice.' },
                    { role: 'user', content: prompt }
                ],
                max_tokens: maxTokens,
                temperature: 0.05,
                top_p: 0.98,
                frequency_penalty: 0.4,
                presence_penalty: 0.3,
                stream: false
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`ChatGPT issue: ${response.status} - ${errorText}`);
        }

        const data = await response.json();
        return data.choices[0].message.content.trim();
    } catch (error) {
        return `ChatGPT error: ${error.message}. Please verify your API key or try again.`;
    }
}

async function callDeepSeek(prompt, maxTokens = 4000, apiKey = localStorage.getItem('deepSeekApiKey')) {
    if (!apiKey) return 'DeepSeek API key missing. Please add it in profile settings.';
    try {
        const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: 'deepseek-coder',
                messages: [
                    { role: 'system', content: localStorage.getItem('customInstruction') || 'Act as an expert coding assistant providing precise, clear, and actionable advice.' },
                    { role: 'user', content: prompt }
                ],
                max_tokens: maxTokens,
                temperature: 0.05,
                top_p: 0.98,
                frequency_penalty: 0.4,
                presence_penalty: 0.3,
                stream: false
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`DeepSeek issue: ${response.status} - ${errorText}`);
        }

        const data = await response.json();
        return data.choices[0].message.content.trim();
    } catch (error) {
        return `DeepSeek error: ${error.message}. Please verify your API key or try again.`;
    }
}

async function callAI(prompt, maxTokens = 4000) {
    const activeModel = localStorage.getItem('activeModel') || document.querySelector('.model-option.active')?.dataset.model;
    if (!activeModel) return 'Please select an AI model in profile settings.';

    const promises = {
        chatgpt: callChatGpt(prompt, maxTokens),
        deepseek: callDeepSeek(prompt, maxTokens)
    };

    try {
        const result = await promises[activeModel];
        if (result.includes('error')) {
            const fallbackModel = activeModel === 'deepseek' ? 'chatgpt' : 'deepseek';
            return await promises[fallbackModel];
        }
        return result;
    } catch (error) {
        return `Error with ${activeModel}: ${error.message}. Please try again or switch models.`;
    }
}

const elements = {
    codeInput: document.getElementById('codeInput'),
    generalInput: document.getElementById('generalInput'),
    homeworkInput: document.getElementById('homeworkInput'),
    analysisInput: document.getElementById('analysisInput'),
    codeOutput: document.getElementById('codeOutput'),
    generalOutput: document.getElementById('generalOutput'),
    homeworkOutput: document.getElementById('homeworkOutput'),
    analysisOutput: document.getElementById('analysisOutput'),
    processBtn: document.getElementById('processBtn'),
    debugBtn: document.getElementById('debugBtn'),
    explainBtn: document.getElementById('explainBtn'),
    obfuscateBtn: document.getElementById('obfuscateBtn'),
    deobfuscateBtn: document.getElementById('deobfuscateBtn'),
    improveBtn: document.getElementById('improveBtn'),
    generalBtn: document.getElementById('generalBtn'),
    homeworkBtn: document.getElementById('homeworkBtn'),
    analyzeBtn: document.getElementById('analyzeBtn'),
    codeProgressBar: document.getElementById('codeProgressBar'),
    codeProgressFill: document.getElementById('codeProgressFill'),
    generalProgressBar: document.getElementById('generalProgressBar'),
    generalProgressFill: document.getElementById('generalProgressFill'),
    homeworkProgressBar: document.getElementById('homeworkProgressBar'),
    homeworkProgressFill: document.getElementById('homeworkProgressFill'),
    analysisProgressBar: document.getElementById('analysisProgressBar'),
    analysisProgressFill: document.getElementById('analysisProgressFill'),
    retryCodeBtn: document.getElementById('retryCodeBtn'),
    retryGeneralBtn: document.getElementById('retryGeneralBtn'),
    retryHomeworkBtn: document.getElementById('retryHomeworkBtn'),
    retryAnalysisBtn: document.getElementById('retryAnalysisBtn'),
    themeToggleBtn: document.getElementById('themeToggleBtn'),
    profileBtn: document.getElementById('profileBtn'),
    codingSection: document.getElementById('codingSection'),
    generalSection: document.getElementById('generalSection'),
    homeworkSection: document.getElementById('homeworkSection'),
    analysisSection: document.getElementById('analysisSection'),
    signOutBtn: document.getElementById('signOutBtn'),
    adminPanelBtn: document.getElementById('adminPanelBtn'),
    copyCodeBtn: document.getElementById('copyCodeBtn'),
    continueBtn: document.getElementById('continueBtn'),
    aiToHumanBtn: document.getElementById('aiToHumanBtn'),
    profileModal: document.getElementById('profileModal'),
    closeProfileBtn: document.getElementById('closeProfileBtn'),
    chatGptApiKey: document.getElementById('chatGptApiKey'),
    deepSeekApiKey: document.getElementById('deepSeekApiKey'),
    customInstruction: document.getElementById('customInstruction'),
    saveApiKeyBtn: document.getElementById('saveApiKeyBtn'),
    languageSelector: document.getElementById('languageSelector'),
    modelSelector: document.getElementById('modelSelector'),
    statusBadge: document.getElementById('statusBadge'),
    statusText: document.getElementById('statusText')
};

if (localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light-mode');
    elements.themeToggleBtn.querySelector('i').classList.replace('fa-moon', 'fa-sun');
    elements.themeToggleBtn.querySelector('span').textContent = 'Dark Mode';
}

elements.themeToggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('light-mode');
    const isLightMode = document.body.classList.contains('light-mode');
    elements.themeToggleBtn.querySelector('i').classList.toggle('fa-moon', !isLightMode);
    elements.themeToggleBtn.querySelector('i').classList.toggle('fa-sun', isLightMode);
    elements.themeToggleBtn.querySelector('span').textContent = isLightMode ? 'Dark Mode' : 'Light Mode';
    localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
});

elements.signOutBtn.addEventListener('click', () => {
    localStorage.clear();
    window.location.href = 'index.html';
});

elements.profileBtn.addEventListener('click', () => {
    elements.chatGptApiKey.value = localStorage.getItem('chatGptApiKey') || '';
    elements.deepSeekApiKey.value = localStorage.getItem('deepSeekApiKey') || '';
    elements.customInstruction.value = localStorage.getItem('customInstruction') || '';
    elements.profileModal.classList.add('active');
});

elements.closeProfileBtn.addEventListener('click', () => {
    elements.profileModal.classList.remove('active');
});

elements.saveApiKeyBtn.addEventListener('click', async () => {
    const chatGptKey = elements.chatGptApiKey.value.trim();
    const deepSeekKey = elements.deepSeekApiKey.value.trim();
    const customInstruction = elements.customInstruction.value.trim();

    localStorage.setItem('chatGptApiKey', chatGptKey);
    localStorage.setItem('deepSeekApiKey', deepSeekKey);
    localStorage.setItem('customInstruction', customInstruction);

    let chatGptValid = false;
    let deepSeekValid = false;

    try {
        if (chatGptKey) {
            chatGptValid = await validateChatGptApiKey(chatGptKey);
            if (!chatGptValid) {
                alert('Invalid ChatGPT API key. Please verify and try again.');
            }
        }
        if (deepSeekKey) {
            deepSeekValid = await validateDeepSeekApiKey(deepSeekKey);
            if (!deepSeekValid) {
                alert('Invalid DeepSeek API key. Please verify and try again.');
            }
        }
    } catch (error) {
        alert(error.message);
    }

    updateModelSelector(chatGptValid, deepSeekValid);
    updateApiStatus();
    elements.profileModal.classList.remove('active');
});

function updateApiStatus() {
    const hasChatGptKey = !!localStorage.getItem('chatGptApiKey');
    const hasDeepSeekKey = !!localStorage.getItem('deepSeekApiKey');
    const isApiActive = hasChatGptKey || hasDeepSeekKey;

    elements.statusText.textContent = isApiActive ? 'API Active' : 'No API Keys';
    elements.statusBadge.classList.toggle('inactive', !isApiActive);
}

function updateModelSelector(chatGptValid, deepSeekValid) {
    elements.modelSelector.innerHTML = '';
    const models = ['chatgpt', 'deepseek'];
    models.forEach(model => {
        const hasApiKey = !!localStorage.getItem(`${model}ApiKey`);
        const isValid = model === 'chatgpt' ? chatGptValid : deepSeekValid;
        if (hasApiKey && isValid) {
            const div = document.createElement('div');
            div.className = `model-option ${localStorage.getItem('activeModel') === model ? 'active' : ''}`;
            div.dataset.model = model;
            div.textContent = model.charAt(0).toUpperCase() + model.slice(1);
            div.addEventListener('click', () => {
                localStorage.setItem('activeModel', model);
                elements.modelSelector.querySelectorAll('.model-option').forEach(o => o.classList.remove('active'));
                div.classList.add('active');
            });
            elements.modelSelector.appendChild(div);
        }
    });

    if (!elements.modelSelector.querySelector('.model-option')) {
        elements.modelSelector.innerHTML = '<span style="color: #ff5555;">Please add a valid API key in Profile Settings.</span>';
    } else if (!localStorage.getItem('activeModel') || !elements.modelSelector.querySelector(`[data-model="${localStorage.getItem('activeModel')}"]`)) {
        const firstModel = elements.modelSelector.querySelector('.model-option');
        if (firstModel) {
            firstModel.classList.add('active');
            localStorage.setItem('activeModel', firstModel.dataset.model);
        }
    }
}

const sectionTabs = document.querySelectorAll('.tab');
const sectionDescriptions = {
    coding: 'Input code or URL for superior processing with precision optimization.',
    general: 'Ask any question for a precise, real-time response.',
    homework: 'Enter problems or questions for detailed, step-by-step solutions with expert guidance.',
    analysis: 'Analyze code for quality, performance, and human-readable insights.'
};

sectionTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        sectionTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const section = tab.dataset.section;
        elements.codingSection.classList.toggle('active', section === 'coding');
        elements.generalSection.classList.toggle('active', section === 'general');
        elements.homeworkSection.classList.toggle('active', section === 'homework');
        elements.analysisSection.classList.toggle('active', section === 'analysis');
        document.querySelectorAll('.btn-primary').forEach(btn => {
            btn.style.display = (btn.id === 'generalBtn' && section === 'general') ||
                               (btn.id === 'homeworkBtn' && section === 'homework') ||
                               (btn.id === 'analyzeBtn' && section === 'analysis') ||
                               (section === 'coding' && btn.id !== 'generalBtn' && btn.id !== 'homeworkBtn' && btn.id !== 'analyzeBtn')
                               ? 'flex' : 'none';
        });
        elements.languageSelector.style.display = section === 'coding' || section === 'analysis' ? 'flex' : 'none';
        document.querySelector('.glass-card h2').textContent = section.charAt(0).toUpperCase() + section.slice(1);
        document.getElementById('sectionDescription').textContent = sectionDescriptions[section];
    });
});

const languageTabs = document.querySelectorAll('.language-option');
languageTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        languageTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
    });
});

elements.copyCodeBtn.addEventListener('click', () => {
    const codeBlock = elements.codeOutput.querySelector('code');
    if (codeBlock) {
        navigator.clipboard.writeText(codeBlock.textContent).then(() => {
            alert('Code copied to your clipboard successfully!');
        }).catch(() => {
            alert('Failed to copy code. Please try again.');
        });
    } else {
        alert('No code available to copy. Process some code first!');
    }
});

elements.continueBtn.addEventListener('click', () => {
    const lastCode = elements.codeOutput.querySelector('code')?.textContent || '';
    processRequest(lastCode, 'coding', 'continue');
});

elements.aiToHumanBtn.addEventListener('click', () => {
    const analysisText = elements.analysisOutput.textContent;
    const humanizedText = humanizeText(analysisText);
    elements.analysisOutput.innerHTML = `<pre><code class="language-text">${humanizedText}</code></pre>`;
    Prism.highlightAll();
});

function humanizeText(text) {
    return text.split('. ')
        .map(sentence => sentence.split(' ').map(word => {
            if (word.match(/^[A-Z]+$/)) return word.charAt(0) + word.slice(1).toLowerCase();
            return word.charAt(0).toUpperCase() + word.slice(1);
        }).join(' ') + '.')
        .join(' ')
        .replace(/([a-z])([A-Z])/g, '$1 $2')
        .replace(/\b\w+\b/g, match => match.charAt(0).toUpperCase() + match.slice(1).toLowerCase());
}

async function processCodeWithAI(code, lang, action) {
    const inputCode = code.trim().match(/^https?:\/\//) ? await fetchCodeFromUrl(code) : code;
    let prompt = `For the given ${lang} code, `;
    switch (action) {
        case 'optimize':
            prompt += `enhance it for peak performance with clean design, efficient loops, and optimal memory use. Ensure correctness and include detailed inline notes for clarity.`;
            break;
        case 'debug':
            prompt += `identify all errors, fix them with precision, and provide detailed explanations for each fix. Return the corrected code with comprehensive notes.`;
            break;
        case 'explain':
            prompt += `break down how this code works step by step, with examples and deep insights into complex areas. Ensure accuracy and clarity in the explanation.`;
            break;
        case 'obfuscate':
            prompt += `transform this code into a cryptic yet fully functional version using advanced renaming and restructuring techniques. Return only the obfuscated code.`;
            break;
        case 'deobfuscate':
            prompt += `unravel this obfuscated code into a clean, readable format with detailed notes for guidance. Return only the deobfuscated code with annotations.`;
            break;
        case 'improve':
            prompt += `elevate this code with best practices, enhanced readability, and superior performance. Include detailed notes for each improvement.`;
            break;
        case 'continue':
            prompt += `extend this ${lang} code seamlessly, maintaining its style with robust error handling and detailed notes for clarity.`;
            break;
        case 'analyze':
            prompt += `evaluate this ${lang} code for inefficiencies, structural issues, and potential improvements. Provide a detailed, actionable report with precise suggestions.`;
            break;
    }
    prompt += `\n\`\`\`${lang}\n${inputCode}\n\`\`\``;
    const result = await callAI(prompt, 3800);
    return result;
}

async function solveHomework(problem) {
    let prompt = `For this problem, deliver a comprehensive, step-by-step solution with accurate explanations, examples, and, if coding-related, polished code with clear notes. If math, show all calculations precisely. If general, break it down clearly:\n${problem}`;
    const solution = await callAI(prompt, 3800);
    return solution;
}

async function processGeneralQuery(query) {
    const prompt = `Answer this question with a clear, detailed, and accurate response:\n${query}`;
    const response = await callAI(prompt, 3800);
    return response;
}

async function processRequest(input, section, action) {
    const sectionMap = {
        coding: { input: elements.codeInput, output: elements.codeOutput, progressBar: elements.codeProgressBar, progressFill: elements.codeProgressFill, retryBtn: elements.retryCodeBtn, continueBtn: elements.continueBtn, outputArea: elements.codingSection.querySelector('.code-area:last-child') },
        general: { input: elements.generalInput, output: elements.generalOutput, progressBar: elements.generalProgressBar, progressFill: elements.generalProgressFill, retryBtn: elements.retryGeneralBtn, outputArea: elements.generalSection.querySelector('.general-area:last-child') },
        homework: { input: elements.homeworkInput, output: elements.homeworkOutput, progressBar: elements.homeworkProgressBar, progressFill: elements.homeworkProgressFill, retryBtn: elements.retryHomeworkBtn, outputArea: elements.homeworkSection.querySelector('.homework-area:last-child') },
        analysis: { input: elements.analysisInput, output: elements.analysisOutput, progressBar: elements.analysisProgressBar, progressFill: elements.analysisProgressFill, retryBtn: elements.retryAnalysisBtn, aiToHumanBtn: elements.aiToHumanBtn, outputArea: elements.analysisSection.querySelector('.analysis-area:last-child') }
    };
    const { output, progressBar, progressFill, retryBtn, continueBtn, aiToHumanBtn, outputArea } = sectionMap[section];

    if (!input) {
        output.innerHTML = '<span style="color: #ff5555;">Please provide input to proceed!</span>';
        return;
    }

    if (!elements.modelSelector.querySelector('.model-option')) {
        output.innerHTML = '<span style="color: #ff5555;">No valid API keys available. Please add one in Profile Settings.</span>';
        return;
    }

    progressBar.classList.add('active');
    progressFill.style.width = '0';
    let width = 0;
    const interval = setInterval(() => {
        width += Math.random() * 8;
        progressFill.style.width = `${Math.min(width, 100)}%`;
        if (width >= 100) clearInterval(interval);
    }, 60);

    let result;
    if (section === 'coding') {
        const activeLang = elements.languageSelector.querySelector('.language-option.active')?.dataset.lang || 'javascript';
        result = await processCodeWithAI(input, activeLang, action);
        if (action !== 'continue') continueBtn.style.display = 'block';
        else continueBtn.style.display = 'none';
    } else if (section === 'general') {
        result = await processGeneralQuery(input);
    } else if (section === 'homework') {
        result = await solveHomework(input);
    } else if (section === 'analysis') {
        const activeLang = elements.languageSelector.querySelector('.language-option.active')?.dataset.lang || 'javascript';
        result = await processCodeWithAI(input, activeLang, 'analyze');
        aiToHumanBtn.style.display = 'block';
    }

    clearInterval(interval);
    progressFill.style.width = '100%';
    setTimeout(() => {
        progressBar.classList.remove('active');
        output.innerHTML = `<pre><code class="language-${section === 'coding' || section === 'analysis' ? (elements.languageSelector.querySelector('.language-option.active')?.dataset.lang || 'javascript') : 'text'}">${result}</code></pre>`;
        outputArea.classList.add('active-response');
        Prism.highlightAll();
        retryBtn.style.display = result.includes('Error') ? 'inline-flex' : 'none';
        setTimeout(() => outputArea.classList.remove('active-response'), 800);
    }, 250);
}

async function fetchCodeFromUrl(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('Failed to fetch the URL or access was denied.');
        return await response.text();
    } catch (error) {
        return `Error fetching from ${url}: ${error.message}.`;
    }
}

elements.processBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'optimize'));
elements.debugBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'debug'));
elements.explainBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'explain'));
elements.obfuscateBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'obfuscate'));
elements.deobfuscateBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'deobfuscate'));
elements.improveBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'improve'));
elements.generalBtn.addEventListener('click', () => processRequest(elements.generalInput.value, 'general', 'general'));
elements.homeworkBtn.addEventListener('click', () => processRequest(elements.homeworkInput.value, 'homework', 'homework'));
elements.analyzeBtn.addEventListener('click', () => processRequest(elements.analysisInput.value, 'analysis', 'analyze'));

elements.retryCodeBtn.addEventListener('click', () => processRequest(elements.codeInput.value, 'coding', 'optimize'));
elements.retryGeneralBtn.addEventListener('click', () => processRequest(elements.generalInput.value, 'general', 'general'));
elements.retryHomeworkBtn.addEventListener('click', () => processRequest(elements.homeworkInput.value, 'homework', 'homework'));
elements.retryAnalysisBtn.addEventListener('click', () => processRequest(elements.analysisInput.value, 'analysis', 'analyze'));

document.querySelectorAll('.clear-btn').forEach(btn => btn.addEventListener('click', () => elements.codeInput.value = ''));
document.querySelectorAll('.clear-general-btn').forEach(btn => btn.addEventListener('click', () => elements.generalInput.value = ''));
document.querySelectorAll('.clear-homework-btn').forEach(btn => btn.addEventListener('click', () => elements.homeworkInput.value = ''));
document.querySelectorAll('.clear-analysis-btn').forEach(btn => btn.addEventListener('click', () => elements.analysisInput.value = ''));

document.querySelectorAll('.copy-input-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.codeInput.value).then(() => alert('Input copied!'))));
document.querySelectorAll('.copy-general-input-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.generalInput.value).then(() => alert('Input copied!'))));
document.querySelectorAll('.copy-homework-input-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.homeworkInput.value).then(() => alert('Input copied!'))));
document.querySelectorAll('.copy-analysis-input-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.analysisInput.value).then(() => alert('Input copied!'))));

document.querySelectorAll('.copy-output-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.codeOutput.textContent).then(() => alert('Output copied!'))));
document.querySelectorAll('.copy-general-output-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.generalOutput.textContent).then(() => alert('Output copied!'))));
document.querySelectorAll('.copy-homework-output-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.homeworkOutput.textContent).then(() => alert('Output copied!'))));
document.querySelectorAll('.copy-analysis-output-btn').forEach(btn => btn.addEventListener('click', () => navigator.clipboard.writeText(elements.analysisOutput.textContent).then(() => alert('Output copied!'))));

document.querySelectorAll('.download-btn').forEach(btn => btn.addEventListener('click', () => downloadText(elements.codeOutput.textContent, 'processed-code.txt')));
document.querySelectorAll('.download-general-btn').forEach(btn => btn.addEventListener('click', () => downloadText(elements.generalOutput.textContent, 'general-response.txt')));
document.querySelectorAll('.download-homework-btn').forEach(btn => btn.addEventListener('click', () => downloadText(elements.homeworkOutput.textContent, 'homework-solution.txt')));
document.querySelectorAll('.download-analysis-btn').forEach(btn => btn.addEventListener('click', () => downloadText(elements.analysisOutput.textContent, 'analysis-report.txt')));

function downloadText(text, filename) {
    const blob = new Blob([text], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

updateModelSelector(false, false);
updateApiStatus();
</script>
</body>
</html>
