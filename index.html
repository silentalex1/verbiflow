<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerbiFlow</title>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" as="style" onload="this.rel='stylesheet'">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);font-family:Poppins,sans-serif;color:#fff;min-height:100vh;display:flex;overflow:auto;animation:bgShift 30s linear infinite}body::-webkit-scrollbar{display:none}@keyframes bgShift{0%{background:linear-gradient(135deg,#0f0c29,#302b63,#24243e)}33%{background:linear-gradient(135deg,#24243e,#0f0c29,#302b63)}66%{background:linear-gradient(135deg,#302b63,#24243e,#0f0c29)}100%{background:linear-gradient(135deg,#0f0c29,#302b63,#24243e)}}.container{display:flex;width:100%;height:100vh}.sidebar{width:60px;background:rgba(15,14,22,.9);transition:width .3s ease;padding:20px 10px;display:flex;flex-direction:column;align-items:center;border-right:1px solid rgba(255,255,255,.15)}.sidebar.open{width:250px;align-items:flex-start}.sidebar-toggle{background:linear-gradient(135deg,#ff6a88,#ff99ac);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;margin-bottom:20px}.sidebar-toggle:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(255,106,136,.7)}.sidebar-toggle svg{width:20px;height:20px;fill:#fff}.sidebar-btn,.sidebar-select{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:12px;color:#fff;padding:10px 15px;margin:5px 0;cursor:pointer;font-size:14px;width:100%;text-align:left;transition:background .3s ease,border .3s ease,box-shadow .3s ease}.sidebar-btn:hover,.sidebar-select:hover{background:rgba(255,106,136,.5);border-color:#ff6a88;box-shadow:0 0 15px rgba(255,106,136,.7)}.sidebar-btn:focus,.sidebar-select:focus{outline:none;border:2px solid #ff99ac;box-shadow:0 0 10px rgba(255,106,136,.8)}.main-area{flex:1;display:flex;flex-direction:column;padding:20px}.header{display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:rgba(15,14,22,.85);border-radius:16px;margin-bottom:20px}.logo{display:flex;align-items:center}.logo-pulse{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#ff6a88,#ff99ac);margin-right:15px;animation:spin3D 4s infinite}@keyframes spin3D{0%{transform:rotateY(0deg)}50%{transform:rotateY(180deg)}100%{transform:rotateY(360deg)}}.logo-text{font-size:24px;font-weight:700;background:linear-gradient(135deg,#ff6a88,#ff99ac);-webkit-background-clip:text;color:transparent}.version{font-size:14px;color:rgba(255,255,255,.6);padding:5px 12px;border-radius:14px;background:rgba(255,255,255,.1)}.api-keys-container{background:rgba(15,14,22,.85);border-radius:16px;padding:20px;margin-bottom:20px}.api-key-section{display:flex;align-items:center;gap:10px;margin-bottom:10px}.api-key-input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background-color:rgba(255,255,255,.05);color:#fff;font-size:14px;outline:none}.api-key-input.error{border-color:#ff0000;animation:pulseError 1s infinite}@keyframes pulseError{0%{box-shadow:0 0 5px rgba(255,0,0,.5)}50%{box-shadow:0 0 15px rgba(255,0,0,.8)}100%{box-shadow:0 0 5px rgba(255,0,0,.5)}}.api-key-input:focus{border-color:#ff6a88;box-shadow:0 0 10px rgba(255,106,136,.5)}.api-key-btn{background:linear-gradient(135deg,#ff6a88,#ff99ac);border:none;padding:8px 16px;border-radius:8px;color:#fff;cursor:pointer;font-size:14px}.api-key-btn:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(255,106,136,.7)}.api-key-btn:focus{outline:none;border:2px solid #ff99ac}.api-key-warning{display:none;color:#ff0000;font-size:12px;margin-top:5px}.file-upload-container{background:rgba(15,14,22,.85);border-radius:16px;padding:20px;margin-bottom:20px}.file-input-label{background:linear-gradient(135deg,#ff6a88,#ff99ac);border:none;padding:10px 20px;border-radius:12px;color:#fff;cursor:pointer;font-size:14px}.file-input-label:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(255,106,136,.7)}.file-input{display:none}.file-preview{background:rgba(0,0,0,.2);padding:10px;border-radius:8px;margin-top:10px;font-size:14px;color:rgba(255,255,255,.9);max-height:100px;overflow-y:auto}.chat-area{flex:1;background:rgba(15,14,22,.85);border-radius:16px;padding:20px;overflow-y:auto;margin-bottom:20px}.chat-history{max-height:100%;overflow-y:auto;padding:10px;border-radius:16px;background:rgba(0,0,0,.2);position:relative}.chat-message{margin-bottom:15px;animation:fadeIn .5s ease forwards}.chat-message:hover{background:rgba(255,255,255,.15);transform:scale(1.02) translateY(-2px);box-shadow:0 2px 10px rgba(0,0,0,.3)}@keyframes fadeIn{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}.chat-message.user{text-align:right}.chat-message.ai{text-align:left}.chat-message-content{display:inline-block;padding:12px 18px;border-radius:12px;font-size:16px;line-height:1.6}.chat-message.user .chat-message-content{background:linear-gradient(135deg,#ff6a88,#ff99ac);color:#fff}.chat-message.ai .chat-message-content{background:rgba(255,255,255,.15);color:rgba(255,255,255,.9)}.chat-message-timestamp{font-size:12px;color:rgba(255,255,255,.5);margin:5px 0}.input-container{display:flex;align-items:center;background:rgba(15,14,22,.85);border-radius:16px;padding:10px;gap:10px}.user-input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background-color:rgba(255,255,255,.05);color:#fff;font-size:14px;outline:none;resize:none}.user-input:focus{border-color:#ff6a88;box-shadow:0 0 10px rgba(255,106,136,.5)}.send-btn{background:linear-gradient(135deg,#ff6a88,#ff99ac);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}.send-btn:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(255,106,136,.7)}.send-btn svg{width:20px;height:20px;fill:#fff}.word-counter{font-size:12px;color:rgba(255,255,255,.5);text-align:right;padding:5px 20px}.neon-mode body{background:linear-gradient(135deg,#1a1a1a,#ff00ff,#00ffff)}.neon-mode .chat-area,.neon-mode .header,.neon-mode .api-keys-container,.neon-mode .file-upload-container{background:rgba(20,20,20,.85);border:1px solid #ff00ff}.light-mode body{background:linear-gradient(135deg,#f0f0f0,#e0e0e0,#d0d0d0)}.light-mode .chat-area,.light-mode .header,.light-mode .api-keys-container,.light-mode .file-upload-container{background:rgba(255,255,255,.95);color:#2a2a2a}.light-mode .chat-message.ai .chat-message-content{background:rgba(0,0,0,.05);color:#2a2a2a}.light-mode .word-counter,.light-mode .chat-message-timestamp{color:rgba(0,0,0,.6)}.high-contrast body{background:#000}.high-contrast .chat-area,.high-contrast .header,.high-contrast .api-keys-container,.high-contrast .file-upload-container{background:#fff;color:#000}.high-contrast .chat-message.ai .chat-message-content{background:#e0e0e0;color:#000}.high-contrast .word-counter,.high-contrast .chat-message-timestamp{color:#000}.focus-mode .sidebar{display:none}.focus-mode .chat-area{box-shadow:0 0 25px rgba(255,106,136,.6)}.ocean-theme .chat-area{background:linear-gradient(135deg,#0a3d62,#1b263b);border:1px solid #3e92cc}.ocean-theme .chat-message.user .chat-message-content{background:linear-gradient(135deg,#3e92cc,#90e0ef)}.forest-theme .chat-area{background:linear-gradient(135deg,#1b4332,#2d6a4f);border:1px solid #52b788}.forest-theme .chat-message.user .chat-message-content{background:linear-gradient(135deg,#52b788,#95d5b2)}@media (max-width:900px){.sidebar.open{width:200px}.main-area{padding:10px}.header,.chat-area,.api-keys-container,.file-upload-container{padding:15px}.logo-text{font-size:20px}}
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                </svg>
            </button>
            <select class="sidebar-select" id="themeToggle">
                <option value="dark">Dark Mode</option>
                <option value="light">Light Mode</option>
                <option value="neon">Neon Mode</option>
            </select>
            <select class="sidebar-select" id="chatTheme">
                <option value="">Default Theme</option>
                <option value="ocean">Ocean Theme</option>
                <option value="forest">Forest Theme</option>
            </select>
            <button class="sidebar-btn" id="debugToggle">Debug Mode</button>
            <button class="sidebar-btn" id="focusToggle">Focus Mode</button>
            <button class="sidebar-btn" id="contrastToggle">High Contrast</button>
            <select class="sidebar-select" id="quickReply">
                <option value="">Quick Reply</option>
                <option value="Explain this in simple terms">Explain this</option>
                <option value="Summarize this">Summarize</option>
                <option value="Provide an example">Example</option>
            </select>
        </div>
        <div class="main-area">
            <div class="header">
                <div class="logo">
                    <div class="logo-pulse"></div>
                    <div class="logo-text">VerbiFlow</div>
                </div>
                <div class="version">v2.0</div>
            </div>
            <div class="api-keys-container">
                <div class="api-key-section">
                    <input type="text" class="api-key-input" id="chatApiKeyInput" placeholder="Chat API Key">
                    <button class="api-key-btn" id="chatApiKeySubmit">Set</button>
                </div>
                <div class="api-key-warning" id="chatApiKeyWarning">Please set a valid Chat API key.</div>
                <div class="api-key-section">
                    <input type="text" class="api-key-input" id="videoApiKeyInput" placeholder="Video API Key">
                    <button class="api-key-btn" id="videoApiKeySubmit">Set</button>
                </div>
                <div class="api-key-warning" id="videoApiKeyWarning">Please set a valid Video API key.</div>
                <div class="api-key-section">
                    <input type="text" class="api-key-input" id="robloxApiKeyInput" placeholder="Roblox API Key">
                    <button class="api-key-btn" id="robloxApiKeySubmit">Set</button>
                </div>
                <div class="api-key-warning" id="robloxApiKeyWarning">Please set a valid Roblox API key.</div>
            </div>
            <div class="file-upload-container">
                <label class="file-input-label" for="fileInput">Upload File</label>
                <input type="file" class="file-input" id="fileInput">
                <div class="file-preview" id="filePreview"></div>
            </div>
            <div class="chat-area" id="chatArea">
                <div class="chat-history" id="chatHistory"></div>
            </div>
            <div class="input-container">
                <textarea class="user-input" id="userInput" placeholder="Ask me anything..." rows="3"></textarea>
                <button class="send-btn" id="sendBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
            <div class="word-counter" id="wordCounter">0 words</div>
        </div>
    </div>
    <script>
        if (typeof micromark === "undefined") {
            window.micromark = (text) => text.replace(/\n/g, "<br>");
        }

        let micromarkLoaded = false;
        async function loadMicromark() {
            if (micromarkLoaded) return;
            try {
                const script = document.createElement("script");
                script.src = "https://cdn.jsdelivr.net/npm/micromark@3.0.10/dist/micromark.min.js";
                script.defer = true;
                document.head.appendChild(script);
                await new Promise(resolve => script.onload = resolve);
                micromarkLoaded = true;
            } catch (error) {
                window.micromark = (text) => text.replace(/\n/g, "<br>");
            }
        }

        async function safeMicromark(text) {
            if (!micromarkLoaded) await loadMicromark();
            return typeof micromark !== "undefined" ? micromark(text) : text.replace(/\n/g, "<br>");
        }

        const sidebar = document.getElementById("sidebar");
        const sidebarToggle = document.getElementById("sidebarToggle");
        const themeToggle = document.getElementById("themeToggle");
        const chatTheme = document.getElementById("chatTheme");
        const debugToggle = document.getElementById("debugToggle");
        const focusToggle = document.getElementById("focusToggle");
        const contrastToggle = document.getElementById("contrastToggle");
        const quickReply = document.getElementById("quickReply");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const chatHistory = document.getElementById("chatHistory");
        const wordCounter = document.getElementById("wordCounter");
        const chatApiKeyInput = document.getElementById("chatApiKeyInput");
        const chatApiKeySubmit = document.getElementById("chatApiKeySubmit");
        const chatApiKeyWarning = document.getElementById("chatApiKeyWarning");
        const videoApiKeyInput = document.getElementById("videoApiKeyInput");
        const videoApiKeySubmit = document.getElementById("videoApiKeySubmit");
        const videoApiKeyWarning = document.getElementById("videoApiKeyWarning");
        const robloxApiKeyInput = document.getElementById("robloxApiKeyInput");
        const robloxApiKeySubmit = document.getElementById("robloxApiKeySubmit");
        const robloxApiKeyWarning = document.getElementById("robloxApiKeyWarning");
        const fileInput = document.getElementById("fileInput");
        const filePreview = document.getElementById("filePreview");
        let conversation = [];
        let chatApiKey = "";
        let videoApiKey = "";
        let robloxApiKey = "";
        let chatApiKeyValid = false;
        let videoApiKeyValid = false;
        let robloxApiKeyValid = false;
        let debugMode = false;

        function formatTimestamp() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
        }

        function addToHistory(role, content) {
            conversation.push({ role, content });
            const messageDiv = document.createElement("div");
            messageDiv.className = `chat-message ${role}`;
            const contentDiv = document.createElement("div");
            contentDiv.className = "chat-message-content";
            contentDiv.innerHTML = content;
            const timestampDiv = document.createElement("div");
            timestampDiv.className = "chat-message-timestamp";
            timestampDiv.textContent = formatTimestamp();
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(timestampDiv);
            chatHistory.insertBefore(messageDiv, chatHistory.firstChild);
            chatHistory.scrollTop = 0;
        }

        function debounce(func, wait) {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func(...args), wait);
            };
        }

        async function validateApiKey(apiKey, type) {
            if (!apiKey) return false;
            return true;
        }

        async function generateChatResponse(message) {
            if (!chatApiKeyValid) {
                addToHistory("assistant", "Please set a valid Chat API key.");
                return;
            }
            addToHistory("user", message);
            const response = `Mock chat response for: ${message}`;
            addToHistory("assistant", await safeMicromark(response));
        }

        async function generateVideo(prompt) {
            if (!videoApiKeyValid) {
                addToHistory("assistant", "Please set a valid Video API key.");
                return;
            }
            addToHistory("user", `Generate a video: ${prompt}`);
            const response = `Mock video generated: [Video URL Placeholder for "${prompt}"]`;
            addToHistory("assistant", await safeMicromark(response));
        }

        async function generateRobloxScript(prompt) {
            if (!robloxApiKeyValid) {
                addToHistory("assistant", "Please set a valid Roblox API key.");
                return;
            }
            addToHistory("user", `Generate a Roblox script: ${prompt}`);
            const response = `Mock Roblox Lua script:\nlocal part = Instance.new("Part")\npart.Position = Vector3.new(0, 5, 0)\npart.Size = Vector3.new(5, 1, 5)\npart.Anchored = true\npart.Parent = game.Workspace`;
            addToHistory("assistant", await safeMicromark(response));
        }

        async function handleFileUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                filePreview.textContent = content.substring(0, 1000);
                addToHistory("user", `Uploaded file: ${file.name}`);
                addToHistory("assistant", `File content preview:\n${content.substring(0, 500)}`);
            };
            if (file.name.endsWith(".rblx")) {
                reader.readAsText(file);
            } else {
                reader.readAsText(file);
            }
        }

        sidebarToggle.onclick = () => {
            sidebar.classList.toggle("open");
        };

        themeToggle.onchange = () => {
            document.body.className = "";
            if (themeToggle.value) document.body.classList.add(`${themeToggle.value}-mode`);
        };

        chatTheme.onchange = () => {
            document.body.classList.remove("ocean-theme", "forest-theme");
            if (chatTheme.value) document.body.classList.add(`${chatTheme.value}-theme`);
        };

        debugToggle.onclick = () => {
            debugMode = !debugMode;
            addToHistory("assistant", `Debug mode ${debugMode ? "enabled" : "disabled"}`);
        };

        focusToggle.onclick = () => {
            document.body.classList.toggle("focus-mode");
        };

        contrastToggle.onclick = () => {
            document.body.classList.toggle("high-contrast");
        };

        quickReply.onchange = () => {
            if (quickReply.value) {
                userInput.value = quickReply.value;
                quickReply.value = "";
                generateChatResponse(userInput.value);
            }
        };

        const debouncedInputHandler = debounce(() => {
            const words = userInput.value.trim().split(/\s+/).filter(Boolean).length;
            wordCounter.textContent = `${words} words`;
        }, 300);

        userInput.addEventListener("input", debouncedInputHandler);

        userInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                const message = userInput.value.trim();
                if (message) {
                    if (message.toLowerCase().startsWith("generate a video")) {
                        generateVideo(message);
                    } else if (message.toLowerCase().startsWith("generate a roblox script")) {
                        generateRobloxScript(message);
                    } else {
                        generateChatResponse(message);
                    }
                    userInput.value = "";
                }
            }
        });

        sendBtn.onclick = () => {
            const message = userInput.value.trim();
            if (message) {
                if (message.toLowerCase().startsWith("generate a video")) {
                    generateVideo(message);
                } else if (message.toLowerCase().startsWith("generate a roblox script")) {
                    generateRobloxScript(message);
                } else {
                    generateChatResponse(message);
                }
                userInput.value = "";
            }
        };

        chatApiKeySubmit.onclick = async () => {
            chatApiKey = chatApiKeyInput.value.trim();
            chatApiKeyValid = await validateApiKey(chatApiKey, "chat");
            chatApiKeyWarning.style.display = chatApiKeyValid ? "none" : "block";
            if (chatApiKeyValid) addToHistory("assistant", "Chat API key set successfully.");
        };

        videoApiKeySubmit.onclick = async () => {
            videoApiKey = videoApiKeyInput.value.trim();
            videoApiKeyValid = await validateApiKey(videoApiKey, "video");
            videoApiKeyWarning.style.display = videoApiKeyValid ? "none" : "block";
            if (videoApiKeyValid) addToHistory("assistant", "Video API key set successfully.");
        };

        robloxApiKeySubmit.onclick = async () => {
            robloxApiKey = robloxApiKeyInput.value.trim();
            robloxApiKeyValid = await validateApiKey(robloxApiKey, "roblox");
            robloxApiKeyWarning.style.display = robloxApiKeyValid ? "none" : "block";
            if (robloxApiKeyValid) addToHistory("assistant", "Roblox API key set successfully.");
        };

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) handleFileUpload(file);
        };
    </script>
</body>
</html>
