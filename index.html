<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerbiFlow - Simple AI Chat</title>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" as="style" onload="this.rel='stylesheet'">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{background:#f5f7fa;font-family:Roboto,sans-serif;color:#333;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}.container{max-width:900px;width:100%;background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);overflow:hidden;display:flex;flex-direction:column}.header{background:#fff;padding:20px;border-bottom:1px solid #e0e0e0;text-align:center}.logo{font-size:24px;font-weight:700;color:#20c997}.chat-area{flex:1;padding:20px;overflow-y:auto;max-height:500px;min-height:400px;background:#fafafa}.chat-history{display:flex;flex-direction:column;gap:15px}.chat-message{display:flex;flex-direction:column;gap:5px;padding:10px;border-radius:12px;max-width:80%;animation:fadeIn 0.3s ease}.chat-message.user{align-self:flex-end;background:#20c997;color:#fff}.chat-message.ai{align-self:flex-start;background:#e0e0e0;color:#333}.chat-message-content{padding:10px 15px;border-radius:12px;font-size:16px;line-height:1.5}.chat-message-meta{font-size:12px;color:#888;margin-top:5px}.code-block{position:relative;margin:10px 0}.code-block pre{background:#2d2d2d;color:#fff;padding:15px;border-radius:8px;overflow-x:auto}.copy-btn{position:absolute;top:10px;right:10px;background:#20c997;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px}.copy-btn:hover{background:#18a77b}.file-upload-container{padding:15px;border-top:1px solid #e0e0e0;background:#fff}.file-actions{display:flex;gap:10px;align-items:center}.file-input-label{background:#20c997;color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500}.file-input{display:none}.file-clear-btn{background:#ff4d4d;color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;border:none}.file-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;margin-top:10px}.file-item{display:flex;align-items:center;gap:10px;background:#f0f0f0;padding:8px;border-radius:8px;cursor:pointer}.file-item:hover{background:#e0e0e0}.file-item-name{flex:1;font-size:14px;color:#333;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-item-details{font-size:12px;color:#888}.file-preview-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:100;padding:20px;justify-content:center;align-items:center}.file-preview-modal.open{display:flex}.file-preview-content{background:#fff;border-radius:12px;padding:15px;max-width:80%;max-height:80%;overflow:auto;color:#333;font-size:14px}.file-preview-close{background:#ff4d4d;color:#fff;border:none;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:absolute;top:15px;right:15px}.file-preview-close svg{width:18px;height:18px;fill:#fff}.input-container{display:flex;align-items:center;padding:15px;border-top:1px solid #e0e0e0;background:#fff;gap:10px}.user-input{flex:1;padding:10px;border:1px solid #e0e0e0;border-radius:8px;font-size:16px;outline:none;resize:none}.user-input:focus{border-color:#20c997}.send-btn{background:#20c997;border:none;border-radius:8px;padding:10px 20px;cursor:pointer;color:#fff;font-size:14px;font-weight:500}.send-btn:hover{background:#18a77b}.send-btn:disabled{background:#ccc;cursor:not-allowed}.loading-spinner{display:none;margin:10px auto;width:30px;height:30px;border:4px solid #20c997;border-top:4px solid transparent;border-radius:50%;animation:spin 1s linear infinite}.typing-indicator{display:none;font-size:14px;color:#888;margin:10px auto;text-align:center}.typing-indicator span{display:inline-block;animation:dotPulse 1.5s infinite ease-in-out}.typing-indicator span:nth-child(2){animation-delay:0.2s}.typing-indicator span:nth-child(3){animation-delay:0.4s}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes dotPulse{0%,80%,100%{transform:scale(1);opacity:0.5}40%{transform:scale(1.5);opacity:1}}@media (max-width:600px){.container{max-width:100%;border-radius:0;box-shadow:none}.header{padding:15px}.logo{font-size:20px}.chat-area{padding:15px;min-height:300px}.chat-message-content{font-size:14px}.input-container{padding:10px}.user-input{font-size:14px}.send-btn{padding:8px 16px}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">VerbiFlow</div>
        </div>
        <div class="chat-area" id="chatArea">
            <div class="chat-history" id="chatHistory">
                <div class="chat-message ai">
                    <div class="chat-message-content">Hello! I'm VerbiFlow, your AI assistant. Ask me anything!</div>
                    <div class="chat-message-meta">Just now</div>
                </div>
            </div>
            <div class="loading-spinner" id="loadingSpinner"></div>
            <div class="typing-indicator" id="typingIndicator">
                VerbiFlow is typing<span>.</span><span>.</span><span>.</span>
            </div>
        </div>
        <div class="file-upload-container" id="fileUploadContainer">
            <div class="file-actions">
                <label class="file-input-label" for="fileInput">Upload File (Max 2GB)</label>
                <input type="file" class="file-input" id="fileInput" multiple>
                <button class="file-clear-btn" id="fileClearBtn" style="display:none;">Clear</button>
            </div>
            <div class="file-list" id="fileList"></div>
        </div>
        <div class="input-container">
            <textarea class="user-input" id="userInput" placeholder="Type your message..." rows="1"></textarea>
            <button class="send-btn" id="sendBtn">Send</button>
        </div>
        <div class="file-preview-modal" id="filePreviewModal">
            <button class="file-preview-close" id="filePreviewClose">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
            <div class="file-preview-content" id="filePreviewContent"></div>
        </div>
    </div>
    <script>
        const API_KEY = "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";
        const API_URL = "https://api.openai.com/v1/chat/completions";
        const chatHistory = document.getElementById('chatHistory');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const fileClearBtn = document.getElementById('fileClearBtn');
        const fileUploadContainer = document.getElementById('fileUploadContainer');
        const filePreviewModal = document.getElementById('filePreviewModal');
        const filePreviewContent = document.getElementById('filePreviewContent');
        const filePreviewClose = document.getElementById('filePreviewClose');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const typingIndicator = document.getElementById('typingIndicator');
        const chatArea = document.getElementById('chatArea');
        let filesArray = [];
        let conversationHistory = [{ role: "assistant", content: "Hello! I'm VerbiFlow, your AI assistant. Ask me anything!" }];

        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = `${userInput.scrollHeight}px`;
        });

        fileInput.addEventListener('change', handleFileUpload);
        fileUploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadContainer.style.background = '#e0e0e0';
        });
        fileUploadContainer.addEventListener('dragleave', () => {
            fileUploadContainer.style.background = '#fff';
        });
        fileUploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadContainer.style.background = '#fff';
            fileInput.files = e.dataTransfer.files;
            handleFileUpload();
        });

        function handleFileUpload() {
            const files = Array.from(fileInput.files);
            files.forEach(file => {
                if (file.size > 2 * 1024 * 1024 * 1024) {
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'chat-message ai';
                    errorMessage.innerHTML = `
                        <div class="chat-message-content">File "${file.name}" exceeds the 2GB limit.</div>
                        <div class="chat-message-meta">Just now</div>
                    `;
                    chatHistory.appendChild(errorMessage);
                    chatArea.scrollTop = chatArea.scrollHeight;
                    return;
                }
                if (!filesArray.some(f => f.name === file.name && f.size === file.size)) {
                    filesArray.push(file);
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <span class="file-item-name">${file.name}</span>
                        <span class="file-item-details">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                    `;
                    fileItem.addEventListener('click', () => previewFile(file));
                    fileList.appendChild(fileItem);
                }
            });
            fileClearBtn.style.display = filesArray.length ? 'block' : 'none';
            fileInput.value = '';
        }

        fileClearBtn.addEventListener('click', () => {
            filesArray = [];
            fileList.innerHTML = '';
            fileClearBtn.style.display = 'none';
        });

        function previewFile(file) {
            filePreviewContent.innerHTML = `<strong>${file.name}</strong><br>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>Type: ${file.type}`;
            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.style.maxWidth = '100%';
                filePreviewContent.appendChild(img);
            } else if (file.type.startsWith('text/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const pre = document.createElement('pre');
                    pre.textContent = e.target.result;
                    filePreviewContent.appendChild(pre);
                };
                reader.readAsText(file);
            }
            filePreviewModal.classList.add('open');
        }

        filePreviewClose.addEventListener('click', () => {
            filePreviewModal.classList.remove('open');
            filePreviewContent.innerHTML = '';
        });

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function formatMessage(content) {
            const codeBlockRegex = /```([\s\S]*?)```/g;
            return content.replace(codeBlockRegex, (match, code) => {
                return `
                    <div class="code-block">
                        <pre>${code.trim()}</pre>
                        <button class="copy-btn" onclick="navigator.clipboard.writeText(\`${code.trim().replace(/`/g, '\\`')}\`)">Copy Code</button>
                    </div>
                `;
            });
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message && filesArray.length === 0) return;

            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.innerHTML = `
                <div class="chat-message-content">${message}</div>
                <div class="chat-message-meta">Just now</div>
            `;
            chatHistory.appendChild(userMessage);
            userInput.value = '';
            userInput.style.height = 'auto';
            chatArea.scrollTop = chatArea.scrollHeight;

            let messageContent = message;
            if (filesArray.length > 0) {
                const fileDescriptions = filesArray.map(file => `File: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`).join(', ');
                messageContent += `\nAttached files: ${fileDescriptions}`;
            }

            conversationHistory.push({ role: "user", content: messageContent });

            typingIndicator.style.display = 'block';
            sendBtn.disabled = true;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: conversationHistory,
                        max_tokens: 300, // Reduced for faster response
                        stream: true, // Enable streaming for faster partial responses
                    }),
                });

                if (!response.ok) throw new Error('API request failed');

                const reader = response.body.getReader();
                let aiMessageText = '';
                const aiMessage = document.createElement('div');
                aiMessage.className = 'chat-message ai';
                aiMessage.innerHTML = `
                    <div class="chat-message-content"></div>
                    <div class="chat-message-meta">Just now</div>
                `;
                chatHistory.appendChild(aiMessage);

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = new TextDecoder().decode(value);
                    const lines = chunk.split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            try {
                                const parsed = JSON.parse(data);
                                const content = parsed.choices[0].delta.content;
                                if (content) {
                                    aiMessageText += content;
                                    aiMessage.querySelector('.chat-message-content').innerHTML = formatMessage(aiMessageText);
                                    chatArea.scrollTop = chatArea.scrollHeight;
                                }
                            } catch (e) {}
                        }
                    }
                }

                conversationHistory.push({ role: "assistant", content: aiMessageText });

                filesArray = [];
                fileList.innerHTML = '';
                fileClearBtn.style.display = 'none';
            } catch (error) {
                const errorMessage = document.createElement('div');
                errorMessage.className = 'chat-message ai';
                errorMessage.innerHTML = `
                    <div class="chat-message-content">Sorry, something went wrong. Please try again.</div>
                    <div class="chat-message-meta">Just now</div>
                `;
                chatHistory.appendChild(errorMessage);
                chatArea.scrollTop = chatArea.scrollHeight;
            } finally {
                typingIndicator.style.display = 'none';
                sendBtn.disabled = false;
            }
        }
    </script>
</body>
</html>
