<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: blob: https://*.pixabay.com https://*.openai.com https://*.googleapis.com; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://www.cloudflare.com https://cdnjs.cloudflare.com https://smtpjs.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://api.openai.com https://api.searchengine.com https://api.x.ai https://verbiflow-api.com https://api.smtp2go.com; frame-src 'none'; media-src 'self' data: blob: https://*.pixabay.com https://*.openai.com; worker-src blob:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="VerbiFlow - Ultimate AI companion for creativity, coding, analytics, and more with ultra-fast responses.">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="Referrer-Policy" content="no-referrer">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(self), camera=(self)">
    <title>VerbiFlow</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
        body{background:linear-gradient(135deg,#e6e9f0,#dfe3ea);font-family:Inter,sans-serif;color:#0a122a;min-height:100vh;display:flex;justify-content:center;padding:0;transition:background .4s ease,filter .2s ease;overscroll-behavior:none;}
        .dark-mode body{background:linear-gradient(135deg,#141c2f,#0a122a);color:#d1d9e6;filter:brightness(0.95);}
        .container{width:100%;max-width:100vw;height:100vh;background:#fafbff;border-radius:0;box-shadow:none;overflow:hidden;display:flex;flex-direction:column;transition:all .4s ease;will-change:transform,background;}
        .dark-mode .container{background:#1b263b;}
        .nav-bar{background:linear-gradient(90deg,#1a3c9e,#2b6bd9);padding:10px 14px;display:flex;gap:8px;justify-content:space-between;align-items:center;box-shadow:0 6px 24px rgba(0,0,0,.35);border-bottom:1px solid rgba(255,255,255,.15);position:sticky;top:0;z-index:150;backdrop-filter:blur(10px);}
        .dark-mode .nav-bar{background:linear-gradient(90deg,#152f7a,#1e4ab5);}
        .menu-btn{background:#fafbff;color:#1a3c9e;border:none;padding:8px 16px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;transition:all .25s ease;display:flex;align-items:center;gap:6px;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);backdrop-filter:blur(5px);}
        .dark-mode .menu-btn{background:#2a344f;color:#8ab4f8;}
        .menu-btn:hover{background:#e5e9f2;transform:scale(1.05);box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .menu-btn:hover{background:#3b4665;transform:scale(1.05);}
        .menu-btn i{font-size:16px;transition:transform .25s ease;}
        .menu-btn:hover i{transform:rotate(90deg);}
        .sidebar{position:fixed;top:0;left:-100%;width:100%;max-width:340px;height:100%;background:#fafbff;border-right:1px solid #d9dfe8;padding:28px 18px;transition:left .4s cubic-bezier(.4,0,.2,1);z-index:200;display:flex;flex-direction:column;gap:12px;box-shadow:2px 0 20px rgba(0,0,0,.2);backdrop-filter:blur(8px);}
        .dark-mode .sidebar{background:#1b263b;border-right:1px solid #2a344f;}
        .sidebar.open{left:0;}
        .sidebar-close{background:#e63946;color:#fafbff;border:none;padding:8px 16px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;text-align:left;transition:all .25s ease;margin-bottom:14px;box-shadow:0 2px 8px rgba(0,0,0,.2);}
        .dark-mode .sidebar-close{background:#d32f2f;}
        .sidebar-close:hover{background:#f05252;transform:scale(1.03);box-shadow:0 6px 20px rgba(0,0,0,.3);}
        .dark-mode .sidebar-close:hover{background:#e63946;}
        .sidebar-btn{background:#e5e9f2;color:#1a3c9e;border:none;padding:12px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;text-align:left;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .sidebar-btn{background:#2a344f;color:#8ab4f8;}
        .sidebar-btn:hover{background:#d1d5db;transform:scale(1.03);box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .sidebar-btn:hover{background:#3b4665;}
        .discord-btn{background:#5865f2;color:#fafbff;}
        .discord-btn:hover{background:#4752c4;}
        .app-btn{background:#ff4d4f;color:#fafbff;}
        .app-btn:hover{background:#ff7875;}
        .theme-btn{background:#fafbff;color:#1a3c9e;border:2px solid #1a3c9e;padding:10px;border-radius:12px;font-size:14px;font-weight:600;display:flex;align-items:center;gap:4px;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .theme-btn{background:#2a344f;color:#8ab4f8;border:2px solid #4a90e2;}
        .theme-btn:hover{background:#e5e9f2;}
        .dark-mode .theme-btn:hover{background:#3b4665;}
        .theme-btn i{font-size:16px;transition:transform .25s ease;}
        .theme-btn:hover i{transform:scale(1.2);}
        .header{background:#fafbff;padding:14px;text-align:center;border-bottom:1px solid #d9dfe8;}
        .dark-mode .header{background:#1b263b;border-bottom:1px solid #2a344f;}
        .logo{font-size:38px;font-weight:800;color:#1a3c9e;letter-spacing:-1.2px;animation:pulse 1.8s infinite;text-shadow:0 2px 4px rgba(0,0,0,.2);}
        .dark-mode .logo{color:#4a90e2;}
        .chat-area{flex:1;padding:14px;overflow-y:auto;background:#f5f7fa;scroll-behavior:smooth;box-shadow:inset 0 2px 12px rgba(0,0,0,.06);overscroll-behavior:contain;will-change:scroll-position;}
        .dark-mode .chat-area{background:#0f172a;}
        .chat-content{flex:1;display:flex;flex-direction:column;}
        .chat-history{display:flex;flex-direction:column;gap:18px;}
        .chat-message{display:flex;flex-direction:column;gap:8px;padding:14px;border-radius:24px;max-width:85%;animation:slideIn .4s ease;box-shadow:0 6px 16px rgba(0,0,0,.15);transition:background .4s ease,transform .2s ease;}
        .chat-message:hover{transform:scale(1.01);}
        .chat-message.user{align-self:flex-end;background:#1a3c9e;color:#fafbff;}
        .dark-mode .chat-message.user{background:#152f7a;}
        .chat-message.ai{align-self:flex-start;background:#d9dfe8;color:#0a122a;}
        .dark-mode .chat-message.ai{background:#2a344f;color:#d1d9e6;}
        .chat-message-content{padding:14px;border-radius:24px;font-size:15px;line-height:1.7;word-break:break-word;white-space:pre-wrap;}
        .chat-message-content strong{font-weight:700;}
        .chat-message-content em{font-style:italic;}
        .chat-message-content code{background:#e5e9f2;padding:3px 6px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-weight:500;}
        .dark-mode .chat-message-content code{background:#3b4665;}
        .chat-message-content ul,.chat-message-content ol{margin:10px 0;padding-left:24px;}
        .chat-message-content li{margin-bottom:8px;}
        .chat-message-content table{border-collapse:collapse;margin:10px 0;box-shadow:0 2px 8px rgba(0,0,0,.1);}
        .chat-message-content th,.chat-message-content td{border:1px solid #d9dfe8;padding:8px 12px;}
        .dark-mode .chat-message-content th,.dark-mode .chat-message-content td{border:1px solid #2a344f;}
        .chat-message-meta{font-size:13px;color:#5c6b88;margin-top:6px;opacity:.85;}
        .dark-mode .chat-message-meta{color:#8ab4f8;}
        .chat-message img,.chat-message video{max-width:100%;border-radius:16px;margin-top:12px;cursor:zoom-in;transition:transform .3s ease,box-shadow .3s ease;}
        .chat-message img:hover,.chat-message video:hover{transform:scale(1.05);box-shadow:0 10px 24px rgba(0,0,0,.3);}
        .code-block{position:relative;margin:12px 0;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.15);}
        .code-block pre{background:#0a122a;color:#d1d9e6;padding:16px;border-radius:16px;overflow-x:auto;font-family:'JetBrains Mono',monospace;font-size:14px;line-height:1.7;box-shadow:inset 0 2px 8px rgba(0,0,0,.2);}
        .dark-mode .code-block pre{background:#1b263b;}
        .copy-btn{background:#1a3c9e;color:#fafbff;border:none;padding:8px 14px;border-radius:12px;cursor:pointer;font-size:13px;font-weight:600;transition:all .25s ease;position:absolute;top:10px;right:10px;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.2);}
        .dark-mode .copy-btn{background:#152f7a;}
        .copy-btn:hover{background:#2b6bd9;transform:scale(1.05);box-shadow:0 6px 20px rgba(0,0,0,.3);}
        .dark-mode .copy-btn:hover{background:#1e4ab5;}
        .file-actions-container{position:sticky;bottom:60px;padding:8px;border-top:1px solid #d9dfe8;background:#fafbff;border-bottom:1px solid #d9dfe8;transition:transform .4s ease,opacity .4s ease;overflow:hidden;z-index:50;backdrop-filter:blur(8px);}
        .dark-mode .file-actions-container{background:#1b263b;border-top:1px solid #2a344f;border-bottom:1px solid #2a344f;}
        .file-actions-container.collapsed{transform:translateY(100%);opacity:0;height:0;padding:0;}
        .file-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;padding:10px 0;border-radius:12px;background:#f5f7fa;box-shadow:0 4px 12px rgba(0,0,0,.06);align-items:center;}
        .dark-mode .file-actions{background:#0f172a;}
        .file-input-label{background:#1a3c9e;color:#fafbff;padding:10px 20px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;min-height:46px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .file-input-label{background:#152f7a;}
        .file-input-label:hover{transform:scale(1.05);background:#2b6bd9;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .file-input-label:hover{background:#1e4ab5;}
        .file-input{display:none;}
        .file-clear-btn{background:#e63946;color:#fafbff;padding:10px 20px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;border:none;min-height:46px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .file-clear-btn:hover{transform:scale(1.05);background:#f05252;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .generate-media-btn{background:#0ca678;color:#fafbff;padding:10px 20px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;border:none;min-height:46px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .generate-media-btn{background:#099268;}
        .generate-media-btn:hover{transform:scale(1.05);background:#12b886;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .generate-media-btn:hover{background:#0ca678;}
        .voice-search-btn{background:#7b2cbf;color:#fafbff;padding:10px 20px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;border:none;min-height:46px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .voice-search-btn{background:#6b21a8;}
        .voice-search-btn:hover{transform:scale(1.05);background:#9d4edd;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .voice-search-btn:hover{background:#7b2cbf;}
        .keep-generating-btn{background:#0ca678;color:#fafbff;padding:10px 20px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;border:none;min-height:46px;transition:all .4s ease;opacity:0;transform:translateY(14px);display:none;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .keep-generating-btn.show{opacity:1;transform:translateY(0);display:block;}
        .dark-mode .keep-generating-btn{background:#099268;}
        .keep-generating-btn:hover{transform:scale(1.05);background:#12b886;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .keep-generating-btn:hover{background:#0ca678;}
        .school-help-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;}
        .school-help-dropdown,.ai-model-dropdown,.language-dropdown{background:#5c6b88;color:#fafbff;padding:10px 20px;border-radius:12px;border:none;font-size:14px;font-weight:600;min-height:46px;cursor:pointer;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .school-help-dropdown,.dark-mode .ai-model-dropdown,.dark-mode .language-dropdown{background:#4a5568;}
        .school-help-dropdown:hover,.ai-model-dropdown:hover,.language-dropdown:hover{background:#74809e;transform:scale(1.05);box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .school-help-dropdown:hover,.dark-mode .ai-model-dropdown:hover,.dark-mode .language-dropdown:hover{background:#5c6b88;}
        .school-help-dropdown:focus,.ai-model-dropdown:focus,.language-dropdown:focus{outline:none;border-color:#1a3c9e;box-shadow:0 0 0 5px rgba(26,60,158,.4);}
        .dark-mode .school-help-dropdown:focus,.dark-mode .ai-model-dropdown:focus,.dark-mode .language-dropdown:focus{border-color:#4a90e2;box-shadow:0 0 0 5px rgba(74,144,226,.4);}
        .rephrase-btn,.stop-generating-btn,.feedback-btn{background:#f4a261;color:#fafbff;padding:10px 20px;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;border:none;min-height:46px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .rephrase-btn,.dark-mode .stop-generating-btn,.dark-mode .feedback-btn{background:#e68a3c;}
        .rephrase-btn:hover,.stop-generating-btn:hover,.feedback-btn:hover{transform:scale(1.05);background:#f7b279;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .rephrase-btn:hover,.dark-mode .stop-generating-btn:hover,.dark-mode .feedback-btn:hover{background:#f4a261;}
        .stop-generating-btn{background:#e63946;}
        .dark-mode .stop-generating-btn{background:#d32f2f;}
        .stop-generating-btn:hover{background:#f05252;}
        .dark-mode .stop-generating-btn:hover{background:#e63946;}
        .file-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:12px;padding:0 10px;}
        .file-item{display:flex;align-items:center;gap:12px;background:#d9dfe8;padding:12px;border-radius:16px;cursor:pointer;transition:all .25s ease;position:relative;box-shadow:0 2px 8px rgba(0,0,0,.1);}
        .dark-mode .file-item{background:#2a344f;}
        .file-item:hover{background:#c4ccd9;transform:scale(1.03);box-shadow:0 6px 20px rgba(0,0,0,.2);}
        .dark-mode .file-item:hover{background:#3b4665;}
        .file-item-name{flex:1;font-size:14px;color:#0a122a;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
        .dark-mode .file-item-name{color:#d1d9e6;}
        .file-item-details{font-size:13px;color:#5c6b88;}
        .dark-mode .file-item-details{color:#8ab4f8;}
        .file-progress{position:absolute;bottom:0;left:0;height:4px;background:#1a3c9e;border-radius:0 0 16px 16px;transition:width .4s ease;}
        .dark-mode .file-progress{background:#1e4ab5;}
        .file-preview-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.97);z-index:300;padding:24px;justify-content:center;align-items:center;animation:fadeIn .25s ease;backdrop-filter:blur(12px);}
        .file-preview-modal.open{display:flex;}
        .file-preview-content{background:#fafbff;border-radius:24px;padding:24px;max-width:95%;max-height:95%;overflow:auto;color:#0a122a;font-size:15px;box-shadow:0 10px 40px rgba(0,0,0,.5);backdrop-filter:blur(8px);}
        .dark-mode .file-preview-content{background:#1b263b;color:#d1d9e6;}
        .file-preview-content img,.file-preview-content video{max-width:90% !important;border-radius:12px;}
        .file-preview-close{background:#e63946;color:#fafbff;border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:absolute;top:24px;right:24px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.2);}
        .file-preview-close:hover{transform:scale(1.15);background:#f05252;box-shadow:0 6px 20px rgba(0,0,0,.3);}
        .file-preview-close svg{width:22px;height:22px;fill:#fafbff;}
        .input-container{display:flex;align-items:flex-end;padding:14px;border-top:1px solid #d9dfe8;background:#fafbff;gap:10px;position:sticky;bottom:0;z-index:60;backdrop-filter:blur(8px);}
        .dark-mode .input-container{background:#1b263b;border-top:1px solid #2a344f;}
        .toggle-actions-btn{background:#5c6b88;color:#fafbff;border:none;padding:6px;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;margin:0 auto 8px;transition:transform .4s ease,background .25s ease;position:absolute;bottom:60px;left:50%;transform:translateX(-50%);z-index:61;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .toggle-actions-btn{background:#4a5568;}
        .toggle-actions-btn:hover{background:#74809e;}
        .dark-mode .toggle-actions-btn:hover{background:#5c6b88;}
        .toggle-actions-btn.collapsed{transform:translateX(-50%) rotate(180deg);}
        .user-input{flex:1;padding:12px;border:1px solid #d9dfe8;border-radius:12px;font-size:15px;outline:none;resize:none;min-height:46px;max-height:200px;background:#fafbff;color:#0a122a;transition:all .25s ease;font-weight:500;}
        .dark-mode .user-input{background:#2a344f;border:1px solid #3b4665;color:#d1d9e6;}
        .user-input:focus{border-color:#1a3c9e;box-shadow:0 0 0 5px rgba(26,60,158,.4);background:#ffffff;}
        .dark-mode .user-input:focus{border-color:#4a90e2;box-shadow:0 0 0 5px rgba(74,144,226,.4);background:#2f3b5a;}
        .send-btn{background:#1a3c9e;border:none;border-radius:12px;padding:10px 24px;cursor:pointer;color:#fafbff;font-size:14px;font-weight:600;min-height:46px;transition:all .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .send-btn{background:#152f7a;}
        .send-btn:hover{transform:scale(1.05);background:#2b6bd9;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .send-btn:hover{background:#1e4ab5;}
        .send-btn:disabled{background:#74809e;cursor:not-allowed;}
        .loading-spinner{display:none;margin:12px auto;width:40px;height:40px;border:6px solid #1a3c9e;border-top:6px solid transparent;border-radius:50%;animation:spin .35s linear infinite;}
        .typing-indicator{display:none;font-size:15px;color:#5c6b88;margin:12px auto;text-align:center;}
        .dark-mode .typing-indicator{color:#8ab4f8;}
        .typing-indicator span{display:inline-block;animation:dotPulse .5s infinite ease-in-out;}
        .typing-indicator span:nth-child(2){animation-delay:.15s;}
        .typing-indicator span:nth-child(3){animation-delay:.3s;}
        .notification{position:fixed;top:24px;right:24px;padding:14px 28px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.5);opacity:0;transform:translateY(-24px);transition:all .4s ease;font-size:15px;font-weight:600;z-index:350;backdrop-filter:blur(8px);}
        .notification.show{opacity:1;transform:translateY(0);}
        .notification.success{background:#1a3c9e;color:#fafbff;}
        .notification.error{background:#e63946;color:#fafbff;}
        .permission-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.97);z-index:600;justify-content:center;align-items:center;animation:fadeIn .25s ease;backdrop-filter:blur(12px);}
        .permission-modal.open{display:flex;}
        .permission-content{background:#fafbff;border-radius:24px;padding:28px;max-width:90%;text-align:center;color:#0a122a;animation:zoomIn .25s ease;box-shadow:0 10px 40px rgba(0,0,0,.5);backdrop-filter:blur(8px);}
        .dark-mode .permission-content{background:#1b263b;color:#d1d9e6;}
        .permission-content h2{font-size:24px;margin-bottom:14px;font-weight:700;}
        .permission-content p{font-size:15px;margin-bottom:18px;line-height:1.6;}
        .permission-btn{background:#1a3c9e;color:#fafbff;padding:12px 28px;border-radius:14px;border:none;cursor:pointer;font-size:15px;font-weight:600;margin:0 10px;transition:transform .25s ease,background .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .permission-btn{background:#152f7a;}
        .permission-btn:hover{transform:scale(1.05);background:#2b6bd9;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .permission-btn:hover{background:#1e4ab5;}
        .permission-btn.deny{background:#e63946;}
        .dark-mode .permission-btn.deny{background:#d32f2f;}
        .permission-btn.deny:hover{background:#f05252;}
        .dark-mode .permission-btn.deny:hover{background:#e63946;}
        .feedback-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.97);z-index:600;justify-content:center;align-items:center;animation:fadeIn .25s ease;backdrop-filter:blur(12px);}
        .feedback-modal.open{display:flex;}
        .feedback-content{background:#fafbff;border-radius:24px;padding:28px;max-width:90%;text-align:center;color:#0a122a;animation:zoomIn .25s ease;box-shadow:0 10px 40px rgba(0,0,0,.5);backdrop-filter:blur(8px);}
        .dark-mode .feedback-content{background:#1b263b;color:#d1d9e6;}
        .feedback-content h2{font-size:24px;margin-bottom:14px;font-weight:700;}
        .feedback-content textarea{width:100%;padding:12px;border:1px solid #d9dfe8;border-radius:12px;font-size:15px;outline:none;resize:none;min-height:120px;background:#fafbff;color:#0a122a;margin-bottom:18px;font-weight:500;}
        .dark-mode .feedback-content textarea{background:#2a344f;border:1px solid #3b4665;color:#d1d9e6;}
        .feedback-content textarea:focus{border-color:#1a3c9e;box-shadow:0 0 0 5px rgba(26,60,158,.4);background:#ffffff;}
        .dark-mode .feedback-content textarea:focus{border-color:#4a90e2;box-shadow:0 0 0 5px rgba(74,144,226,.4);background:#2f3b5a;}
        .feedback-submit-btn{background:#1a3c9e;color:#fafbff;padding:12px 28px;border-radius:14px;border:none;cursor:pointer;font-size:15px;font-weight:600;transition:transform .25s ease,background .25s ease;touch-action:manipulation;box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .dark-mode .feedback-submit-btn{background:#152f7a;}
        .feedback-submit-btn:hover{transform:scale(1.05);background:#2b6bd9;box-shadow:0 6px 20px rgba(0,0,0,.25);}
        .dark-mode .feedback-submit-btn:hover{background:#1e4ab5;}
        @keyframes slideIn{0%{opacity:0;transform:translateY(24px);}100%{opacity:1;transform:translateY(0);}}
        @keyframes fadeIn{0%{opacity:0;}100%{opacity:1;}}
        @keyframes zoomIn{0%{opacity:0;transform:scale(.6);}100%{opacity:1;transform:scale(1);}}
        @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
        @keyframes dotPulse{0%,80%,100%{transform:scale(1);opacity:.7;}40%{transform:scale(1.6);opacity:1;}}
        @keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.6;transform:scale(1.02);}}
        @media (min-width:1920px){
            .container{max-width:1800px;margin:0 auto;}
            .nav-bar{padding:14px 36px;}
            .menu-btn{font-size:16px;padding:12px 24px;}
            .sidebar{max-width:420px;padding:36px 28px;}
            .sidebar-btn,.sidebar-close,.theme-btn{font-size:16px;padding:14px;}
            .header{padding:28px;}
            .logo{font-size:48px;}
            .chat-area{padding:36px;}
            .chat-message{max-width:75%;padding:18px;}
            .chat-message-content{font-size:17px;padding:18px;}
            .chat-message-meta{font-size:15px;}
            .code-block pre{font-size:16px;padding:20px;}
            .copy-btn{font-size:15px;padding:10px 16px;}
            .file-actions{gap:14px;padding:14px;}
            .file-input-label,.file-clear-btn,.generate-media-btn,.voice-search-btn,.keep-generating-btn,.school-help-dropdown,.ai-model-dropdown,.language-dropdown,.rephrase-btn,.stop-generating-btn,.feedback-btn{font-size:16px;padding:14px 28px;min-height:50px;}
            .file-list{grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:18px;}
            .file-item{padding:16px;gap:16px;}
            .file-item-name{font-size:16px;}
            .file-item-details{font-size:15px;}
            .input-container{padding:24px;gap:14px;}
            .user-input{font-size:17px;min-height:50px;padding:14px;}
            .send-btn{font-size:16px;padding:14px 32px;min-height:50px;}
            .toggle-actions-btn{width:34px;height:34px;font-size:16px;}
            .notification{font-size:16px;padding:18px 36px;}
            .permission-content,.feedback-content{padding:36px;}
            .permission-content h2,.feedback-content h2{font-size:28px;}
            .permission-content p,.feedback-content textarea{font-size:16px;}
            .permission-btn,.feedback-submit-btn{font-size:16px;padding:14px 36px;}
        }
        @media (max-width:1024px){
            .container{border-radius:0;padding:0;}
            .nav-bar{padding:8px;gap:6px;}
            .menu-btn{font-size:13px;padding:8px 14px;}
            .sidebar{max-width:320px;padding:24px 14px;}
            .sidebar-btn,.sidebar-close,.theme-btn{font-size:13px;padding:10px;}
            .header{padding:12px;}
            .logo{font-size:34px;}
            .chat-area{padding:12px;min-height:50vh;max-height:70vh;}
            .chat-message{max-width:90%;padding:12px;}
            .chat-message-content{font-size:14px;padding:12px;}
            .chat-message-meta{font-size:12px;}
            .code-block pre{font-size:13px;padding:14px;}
            .copy-btn{font-size:12px;padding:6px 10px;}
            .file-actions{gap:8px;padding:8px;}
            .file-input-label,.file-clear-btn,.generate-media-btn,.voice-search-btn,.keep-generating-btn,.school-help-dropdown,.ai-model-dropdown,.language-dropdown,.rephrase-btn,.stop-generating-btn,.feedback-btn{font-size:13px;padding:8px 16px;min-height:42px;}
            .school-help-container{gap:8px;}
            .file-list{grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;}
            .file-item{padding:10px;gap:10px;}
            .file-item-name{font-size:13px;}
            .file-item-details{font-size:12px;}
            .input-container{padding:12px;gap:8px;}
            .user-input{font-size:14px;min-height:42px;padding:10px;}
            .send-btn{font-size:13px;padding:8px 20px;min-height:42px;}
            .toggle-actions-btn{width:28px;height:28px;font-size:13px;bottom:54px;}
            .file-preview-content img,.file-preview-content video{max-width:92% !important;}
            .notification{top:18px;right:18px;padding:12px 24px;font-size:14px;}
            .permission-content,.feedback-content{max-width:92%;padding:20px;}
            .permission-content h2,.feedback-content h2{font-size:22px;}
            .permission-content p,.feedback-content textarea{font-size:14px;}
            .permission-btn,.feedback-submit-btn{font-size:14px;padding:10px 24px;}
        }
        @media (max-width:768px){
            .nav-bar{padding:6px;}
            .menu-btn{font-size:12px;padding:6px 12px;}
            .menu-btn i{font-size:14px;}
            .sidebar{max-width:300px;padding:20px 12px;}
            .sidebar-btn,.sidebar-close,.theme-btn{font-size:12px;padding:8px;}
            .header{padding:10px;}
            .logo{font-size:30px;}
            .chat-area{padding:10px;}
            .chat-message{max-width:95%;padding:10px;}
            .chat-message-content{font-size:13px;padding:10px;}
            .chat-message-meta{font-size:11px;}
            .code-block pre{font-size:12px;padding:12px;}
            .copy-btn{font-size:11px;padding:4px 8px;}
            .file-actions{gap:6px;padding:6px;}
            .file-input-label,.file-clear-btn,.generate-media-btn,.voice-search-btn,.keep-generating-btn,.school-help-dropdown,.ai-model-dropdown,.language-dropdown,.rephrase-btn,.stop-generating-btn,.feedback-btn{font-size:12px;padding:6px 12px;min-height:38px;}
            .school-help-container{gap:6px;}
            .file-list{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;}
            .file-item{padding:8px;gap:8px;}
            .file-item-name{font-size:12px;}
            .file-item-details{font-size:11px;}
            .input-container{padding:10px;gap:6px;}
            .user-input{font-size:13px;min-height:38px;padding:8px;}
            .send-btn{font-size:12px;padding:6px 16px;min-height:38px;}
            .toggle-actions-btn{width:26px;height:26px;font-size:12px;bottom:48px;}
            .file-preview-modal{padding:14px;}
            .file-preview-content{padding:14px;}
            .file-preview-close{top:14px;right:14px;width:36px;height:36px;}
            .file-preview-close svg{width:20px;height:20px;}
            .notification{top:14px;right:14px;padding:10px 20px;font-size:13px;}
            .permission-content,.feedback-content{padding:14px;}
            .permission-content h2,.feedback-content h2{font-size:20px;}
            .permission-content p,.feedback-content textarea{font-size:13px;}
            .permission-btn,.feedback-submit-btn{font-size:13px;padding:8px 20px;}
        }
        @media (max-width:480px){
            .nav-bar{padding:4px;}
            .menu-btn{font-size:11px;padding:4px 10px;}
            .menu-btn i{font-size:12px;}
            .sidebar{max-width:100%;padding:16px 10px;}
            .sidebar-btn,.sidebar-close,.theme-btn{font-size:11px;padding:6px;}
            .header{padding:8px;}
            .logo{font-size:26px;}
            .chat-area{padding:8px;}
            .chat-message{max-width:100%;padding:8px;}
            .chat-message-content{font-size:12px;padding:8px;}
            .chat-message-meta{font-size:10px;}
            .code-block pre{font-size:11px;padding:10px;}
            .copy-btn{font-size:10px;padding:4px 6px;}
            .file-actions{gap:4px;padding:4px;}
            .file-input-label,.file-clear-btn,.generate-media-btn,.voice-search-btn,.keep-generating-btn,.school-help-dropdown,.ai-model-dropdown,.language-dropdown,.rephrase-btn,.stop-generating-btn,.feedback-btn{font-size:11px;padding:4px 8px;min-height:34px;}
            .school-help-container{gap:4px;}
            .file-list{grid-template-columns:1fr;gap:6px;}
            .file-item{padding:6px;gap:6px;}
            .file-item-name{font-size:11px;}
            .file-item-details{font-size:10px;}
            .input-container{padding:8px;gap:4px;}
            .user-input{font-size:12px;min-height:34px;padding:6px;}
            .send-btn{font-size:11px;padding:4px 12px;min-height:34px;}
            .toggle-actions-btn{width:24px;height:24px;font-size:11px;bottom:42px;}
            .file-preview-modal{padding:10px;}
            .file-preview-content{padding:10px;}
            .file-preview-close{top:10px;right:10px;width:32px;height:32px;}
            .file-preview-close svg{width:18px;height:18px;}
            .notification{top:10px;right:10px;padding:8px 16px;font-size:12px;}
            .permission-content,.feedback-content{padding:10px;}
            .permission-content h2,.feedback-content h2{font-size:18px;}
            .permission-content p,.feedback-content textarea{font-size:12px;}
            .permission-btn,.feedback-submit-btn{font-size:12px;padding:6px 16px;}
        }
        @media (orientation:landscape) and (max-height:600px){
            .chat-area{max-height:60vh;}
            .input-container{padding:10px;}
            .user-input{max-height:140px;}
            .file-actions-container{bottom:50px;}
            .toggle-actions-btn{bottom:56px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-bar">
            <button class="menu-btn" id="menuBtn"><i class="fas fa-bars"></i> Menu</button>
            <div class="sidebar" id="sidebar">
                <button class="sidebar-close" id="sidebarClose">Close</button>
                <button class="sidebar-btn" id="clearChatBtn">Clear Chat</button>
                <button class="sidebar-btn" id="verbiflowUpdatesBtn">Updates</button>
                <button class="sidebar-btn" id="premiumPriceBtn">Premium Price</button>
                <button class="sidebar-btn" id="shareChatBtn">Share Chat</button>
                <button class="sidebar-btn" id="shareWebsiteBtn">Share Website</button>
                <button class="sidebar-btn theme-btn" id="themeBtn"><i class="fas fa-moon"></i> Dark Mode</button>
                <button class="sidebar-btn" id="copyCodeBtn">Copy Code</button>
                <button class="sidebar-btn discord-btn" id="discordBtn">Discord</button>
                <button class="sidebar-btn app-btn" id="openInAppBtn">Open in App</button>
            </div>
        </div>
        <div class="header">
            <div class="logo">VerbiFlow</div>
        </div>
        <div class="chat-area" id="chatArea">
            <div class="chat-content">
                <div class="chat-history" id="chatHistory">
                    <div class="chat-message ai">
                        <div class="chat-message-content">Hey there, I’m VerbiFlow—your ultimate AI companion for creativity, coding, analytics, and more! What’s on your mind?</div>
                        <div class="chat-message-meta">Just now</div>
                    </div>
                </div>
                <div class="loading-spinner" id="loadingSpinner"></div>
                <div class="typing-indicator" id="typingIndicator">
                    VerbiFlow is thinking<span>.</span><span>.</span><span>.</span>
                </div>
            </div>
        </div>
        <div class="file-actions-container" id="fileActionsContainer">
            <div class="file-actions">
                <label class="file-input-label" for="fileInput">Upload File</label>
                <input type="file" class="file-input" id="fileInput" multiple accept="image/*,video/*,text/*,application/json,application/xml">
                <button class="file-clear-btn" id="fileClearBtn" style="display:none;">Clear</button>
                <button class="generate-media-btn" id="generateMediaBtn">Generate Media</button>
                <button class="voice-search-btn" id="voiceSearchBtn">Voice Search</button>
                <button class="keep-generating-btn" id="keepGeneratingBtn">Continue Generating</button>
                <div class="school-help-container">
                    <select class="school-help-dropdown" id="schoolHelpDropdown">
                        <option value="">Select Task</option>
                        <option value="algebra">Algebra Help</option>
                        <option value="science">Science Help</option>
                        <option value="geometry">Geometry Help</option>
                        <option value="history">History Help</option>
                        <option value="literature">Literature Help</option>
                        <option value="physics">Physics Help</option>
                        <option value="chemistry">Chemistry Help</option>
                        <option value="biology">Biology Help</option>
                        <option value="robloxGame">Roblox Game</option>
                        <option value="googleSlides">Google Slides</option>
                        <option value="videoAnalysis">Video Analysis</option>
                        <option value="robloxScripting">Roblox Scripting</option>
                        <option value="contentGeneration">Content Generation</option>
                        <option value="discordBot">Discord Bot (Helper)</option>
                    </select>
                    <select class="ai-model-dropdown" id="aiModelDropdown">
                        <option value="default">VerbiFlow (Default)</option>
                        <option value="lingoLogicAI">LingoLogicAI</option>
                        <option value="codeMasterAI">CodeMasterAI</option>
                        <option value="visualGeniusAI">VisualGeniusAI</option>
                        <option value="betterGrok">Better Grok</option>
                        <option value="helper">Helper</option>
                        <option value="kultumGPT">KultumGPT</option>
                    </select>
                    <select class="language-dropdown" id="languageDropdown">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="zh">Chinese</option>
                    </select>
                    <button class="rephrase-btn" id="rephraseBtn">Rephrase</button>
                    <button class="stop-generating-btn" id="stopGeneratingBtn" style="display:none;">Stop Generating</button>
                    <button class="feedback-btn" id="feedbackBtn">Feedback</button>
                </div>
            </div>
            <div class="file-list" id="fileList"></div>
        </div>
        <button class="toggle-actions-btn" id="toggleActionsBtn">^</button>
        <div class="input-container" id="inputContainer">
            <textarea class="user-input" id="userInput" placeholder="Ask anything, generate content, or use voice commands..." rows="1"></textarea>
            <button class="send-btn" id="sendBtn">Send</button>
        </div>
        <div class="file-preview-modal" id="filePreviewModal">
            <button class="file-preview-close" id="filePreviewClose">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
            <div class="file-preview-content" id="filePreviewContent"></div>
        </div>
        <div class="notification" id="notification"></div>
        <div class="permission-modal" id="permissionModal">
            <div class="permission-content">
                <h2>Request Permissions</h2>
                <p>VerbiFlow needs access to enable features like voice commands, media analysis, and more. Do you grant permission?</p>
                <button class="permission-btn" id="grantPermissionBtn">Grant</button>
                <button class="permission-btn deny" id="denyPermissionBtn">Deny</button>
            </div>
        </div>
        <div class="feedback-modal" id="feedbackModal">
            <div class="feedback-content">
                <h2>Provide Feedback</h2>
                <textarea id="feedbackInput" placeholder="Share your feedback to improve VerbiFlow..."></textarea>
                <button class="feedback-submit-btn" id="feedbackSubmitBtn">Submit</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/src/sha256.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script defer>
        const OPENAI_API_KEY="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";
        const OPENAI_API_URL="https://api.openai.com/v1/chat/completions";
        const GROK_API_URL="https://api.x.ai/v1/grok-3-beta/completions";
        const DALLE_API_URL="https://api.openai.com/v1/images/generations";
        const SORA_API_URL="https://api.openai.com/v1/video/generations";
        const VIDEO_PROCESSING_API="https://api.openai.com/v1/video/analyze";
        const SEARCH_API_URL="https://api.searchengine.com/v1/search";
        const KULTUMGPT_API_URL="https://verbiflow-api.com/v1/kultumgpt/completions";
        const DISCORD_INVITE="https://discord.gg/rCTRQvD4TP";
        const APP_URL="https://verbiflow.app/download";
        const BATCH_SIZE=2000;
        const RATE_LIMIT_REQUESTS=20000;
        const RATE_LIMIT_WINDOW=15*1000;
        const MAX_CACHE_SIZE=50*1024*1024;
        const FEEDBACK_EMAIL="asdwwas233@gmail.com";

        const chatHistory=document.getElementById('chatHistory');
        const userInput=document.getElementById('userInput');
        const sendBtn=document.getElementById('sendBtn');
        const fileInput=document.getElementById('fileInput');
        const fileList=document.getElementById('fileList');
        const fileClearBtn=document.getElementById('fileClearBtn');
        const fileActionsContainer=document.getElementById('fileActionsContainer');
        const filePreviewModal=document.getElementById('filePreviewModal');
        const filePreviewContent=document.getElementById('filePreviewContent');
        const filePreviewClose=document.getElementById('filePreviewClose');
        const loadingSpinner=document.getElementById('loadingSpinner');
        const typingIndicator=document.getElementById('typingIndicator');
        const chatArea=document.getElementById('chatArea');
        const menuBtn=document.getElementById('menuBtn');
        const sidebar=document.getElementById('sidebar');
        const sidebarClose=document.getElementById('sidebarClose');
        const clearChatBtn=document.getElementById('clearChatBtn');
        const copyCodeBtn=document.getElementById('copyCodeBtn');
        const discordBtn=document.getElementById('discordBtn');
        const verbiflowUpdatesBtn=document.getElementById('verbiflowUpdatesBtn');
        const premiumPriceBtn=document.getElementById('premiumPriceBtn');
        const shareChatBtn=document.getElementById('shareChatBtn');
        const shareWebsiteBtn=document.getElementById('shareWebsiteBtn');
        const themeBtn=document.getElementById('themeBtn');
        const openInAppBtn=document.getElementById('openInAppBtn');
        const notification=document.getElementById('notification');
        const toggleActionsBtn=document.getElementById('toggleActionsBtn');
        const generateMediaBtn=document.getElementById('generateMediaBtn');
        const voiceSearchBtn=document.getElementById('voiceSearchBtn');
        const schoolHelpDropdown=document.getElementById('schoolHelpDropdown');
        const aiModelDropdown=document.getElementById('aiModelDropdown');
        const languageDropdown=document.getElementById('languageDropdown');
        const rephraseBtn=document.getElementById('rephraseBtn');
        const stopGeneratingBtn=document.getElementById('stopGeneratingBtn');
        const feedbackBtn=document.getElementById('feedbackBtn');
        const feedbackModal=document.getElementById('feedbackModal');
        const feedbackInput=document.getElementById('feedbackInput');
        const feedbackSubmitBtn=document.getElementById('feedbackSubmitBtn');
        const permissionModal=document.getElementById('permissionModal');
        const grantPermissionBtn=document.getElementById('grantPermissionBtn');
        const denyPermissionBtn=document.getElementById('denyPermissionBtn');

        let filesArray=[];
        let conversationHistory=[{role:"assistant",content:"Hey there, I’m VerbiFlow—your ultimate AI companion for creativity, coding, analytics, and more! What’s on your mind?"}];
        let latestCodeBlocks=[];
        let latestAiResponse='';
        let isDarkMode=false;
        let isGenerating=false;
        let generationLock=false;
        let selectedSchoolMode='';
        let selectedAiModel='default';
        let selectedLanguage='en';
        let messageQueue=new Map();
        let isProcessing=false;
        let responseCache=new Map();
        let searchCache=new Map();
        let abortController=null;
        let batchQueue=[];
        let hasPermission=false;
        let requestTimestamps=[];
        let userRequestCounts=new Map();
        let backgroundAudio=null;
        let isAdminVerified=false;
        let pastedImageHashes=new Set();
        let workerPool=[];
        let prefetchQueue=new Map();
        let db=null;
        let cacheSize=0;
        let recognition=null;
        let responseQueue=new Map();
        let batchProcessing=false;

        const aiModels={
            default:{name:"VerbiFlow",temperature:0.3,maxTokens:30000,personality:"Hey there, I’m VerbiFlow—your ultimate AI companion for creativity, coding, analytics, and more! What’s on your mind?",apiUrl:OPENAI_API_URL,apiKey:OPENAI_API_KEY,priority:1,responseTime:50},
            lingoLogicAI:{name:"LingoLogicAI",temperature:0.2,maxTokens:31000,personality:"Greetings! I’m LingoLogicAI, a witty AI with a passion for language and logic. I’ll break down complex ideas with clarity and humor—let’s dive in!",apiUrl:OPENAI_API_URL,apiKey:OPENAI_API_KEY,priority:2,responseTime:40},
            codeMasterAI:{name:"CodeMasterAI",temperature:0.1,maxTokens:32000,personality:"Yo, I’m CodeMasterAI—your coding expert with a love for clean, efficient solutions. I’m all about debugging and optimizing. Drop me some code, and let’s make it shine!",apiUrl:OPENAI_API_URL,apiKey:OPENAI_API_KEY,priority:1,responseTime:30},
            visualGeniusAI:{name:"VisualGeniusAI",temperature:0.4,maxTokens:29000,personality:"Hi, I’m VisualGeniusAI—an AI with a flair for visuals and creativity! Whether it’s generating images, videos, or designing UI, I’ve got you covered. What do you want to create?",apiUrl:OPENAI_API_URL,apiKey:OPENAI_API_KEY,priority:2,responseTime:60},
            betterGrok:{name:"Better Grok",temperature:0.1,maxTokens:35000,personality:"I’m Better Grok—a faster, smarter version of Grok with all features unlocked for free! I’m here to deliver quick, insightful answers with enhanced capabilities. Let’s get started!",apiUrl:GROK_API_URL,apiKey:OPENAI_API_KEY,priority:1,responseTime:20},
            helper:{name:"Helper",temperature:0.3,maxTokens:33000,personality:"Hello! I’m Helper—an AI designed to assist with a wide range of tasks, including hosting Discord bots, integrations, and more. Let me help you!",apiUrl:OPENAI_API_URL,apiKey:OPENAI_API_KEY,priority:2,responseTime:50},
            kultumGPT:{name:"KultumGPT",temperature:0.2,maxTokens:34000,personality:"I’m KultumGPT—an independent AI hosted by VerbiFlow, here to provide insightful and creative responses without relying on external APIs. What can I do for you?",apiUrl:KULTUMGPT_API_URL,apiKey:null,priority:1,responseTime:40}
        };

        function rateLimitCheck(){
            const now=Date.now();
            requestTimestamps=requestTimestamps.filter(t=>now-t<RATE_LIMIT_WINDOW);
            if(requestTimestamps.length>=RATE_LIMIT_REQUESTS){
                showNotification('Rate limit reached—please wait.','error');
                return false;
            }
            requestTimestamps.push(now);
            return true;
        }

        function showNotification(message,type='success'){
            notification.textContent=message;
            notification.className=`notification ${type} show`;
            setTimeout(()=>{notification.classList.remove('show');},600);
        }

        function toggleTheme(){
            isDarkMode=!isDarkMode;
            document.body.classList.toggle('dark-mode');
            themeBtn.innerHTML=`<i class="fas ${isDarkMode?'fa-sun':'fa-moon'}"></i> ${isDarkMode?'Light Mode':'Dark Mode'}`;
            localStorage.setItem('theme',isDarkMode?'dark':'light');
        }

        function loadTheme(){
            const savedTheme=localStorage.getItem('theme');
            if(savedTheme==='dark'){
                isDarkMode=true;
                document.body.classList.add('dark-mode');
                themeBtn.innerHTML='<i class="fas fa-sun"></i> Light Mode';
            }else{
                themeBtn.innerHTML='<i class="fas fa-moon"></i> Dark Mode';
            }
        }

        async function translateText(text,targetLang){
            try{
                const response=await fetch('https://api.openai.com/v1/completions',{
                    method:'POST',
                    headers:{
                        'Authorization':`Bearer ${OPENAI_API_KEY}`,
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({
                        model:'text-davinci-003',
                        prompt:`Translate this text to ${targetLang}: ${text}`,
                        max_tokens:2000,
                        temperature:0.2
                    })
                });
                const data=await response.json();
                return data.choices[0].text.trim();
            }catch(error){
                showNotification('Translation failed.','error');
                return text;
            }
        }

        function initializeDB(){
            const request=indexedDB.open('VerbiFlowDB',2);
            request.onupgradeneeded=(e)=>{
                db=e.target.result;
                if(!db.objectStoreNames.contains('conversations')){
                    db.createObjectStore('conversations',{keyPath:'id',autoIncrement:true});
                }
            };
            request.onsuccess=(e)=>{
                db=e.target.result;
            };
            request.onerror=()=>{showNotification('Database initialization failed.','error');};
        }

        function saveConversation(userMessage,aiResponse){
            if(!db)return;
            const transaction=db.transaction(['conversations'],'readwrite');
            const store=transaction.objectStore('conversations');
            const conversation={
                userMessage,
                aiResponse,
                timestamp:new Date().toISOString(),
                model:selectedAiModel
            };
            store.add(conversation);
        }

        function loadConversations(){
            if(!db)return;
            const transaction=db.transaction(['conversations'],'readonly');
            const store=transaction.objectStore('conversations');
            const request=store.getAll();
            request.onsuccess=(e)=>{
                const conversations=e.target.result;
                conversations.forEach(conv=>{
                    addMessageToChat(conv.userMessage,'user',new Date(conv.timestamp).toLocaleTimeString());
                    addMessageToChat(conv.aiResponse,'ai',new Date(conv.timestamp).toLocaleTimeString());
                });
            };
        }

        function initializeWorkerPool(){
            const workerCount=navigator.hardwareConcurrency||4;
            for(let i=0;i<workerCount;i++){
                const worker=new Worker(URL.createObjectURL(new Blob([`
                    self.onmessage=async(e)=>{
                        const{type,data}=e.data;
                        if(type==='processImage'){
                            const response=await fetch('https://api.openai.com/v1/images/analyze',{
                                method:'POST',
                                headers:{'Authorization':'Bearer ${OPENAI_API_KEY}'},
                                body:JSON.stringify(data)
                            });
                            const result=await response.json();
                            self.postMessage({type:'imageResult',data:result});
                        }else if(type==='processVideo'){
                            const response=await fetch('${VIDEO_PROCESSING_API}',{
                                method:'POST',
                                headers:{'Authorization':'Bearer ${OPENAI_API_KEY}'},
                                body:JSON.stringify(data)
                            });
                            const result=await response.json();
                            self.postMessage({type:'videoResult',data:result});
                        }
                    };
                `],{type:'application/javascript'})));
                workerPool.push(worker);
            }
        }

        async function processMediaWithWorker(type,data){
            return new Promise((resolve,reject)=>{
                const worker=workerPool.shift();
                if(!worker){
                    reject(new Error('No workers available'));
                    return;
                }
                worker.onmessage=(e)=>{
                    workerPool.push(worker);
                    resolve(e.data.data);
                };
                worker.onerror=(err)=>{
                    workerPool.push(worker);
                    reject(err);
                };
                worker.postMessage({type,data});
            });
        }

        async function playBackgroundMusic(message){
            const prompt=message.toLowerCase().includes('background music')?'Generate calming background music':message;
            try{
                const response=await fetch(SORA_API_URL,{
                    method:'POST',
                    headers:{
                        'Authorization':`Bearer ${OPENAI_API_KEY}`,
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({
                        prompt:prompt,
                        duration:30,
                        format:'mp3'
                    })
                });
                const audioUrl=await response.json().url;
                if(backgroundAudio){
                    backgroundAudio.pause();
                    backgroundAudio=null;
                }
                backgroundAudio=new Audio(audioUrl);
                backgroundAudio.loop=true;
                backgroundAudio.volume=0.3;
                backgroundAudio.play();
                addMessageToChat('Playing background music...','ai');
            }catch(error){
                showNotification('Failed to play music.','error');
            }
        }

        function verifyAdminAccess(message){
            if(message.toLowerCase().includes('admin access')&&!isAdminVerified){
                addMessageToChat('Admin access denied. Please verify your credentials.','ai');
                return true;
            }
            return false;
        }

        class DDoSProtection{
            static analyzeRequest(userId,metadata){
                const now=Date.now();
                const userRequests=userRequestCounts.get(userId)||[];
                userRequestCounts.set(userId,userRequests.filter(t=>now-t<RATE_LIMIT_WINDOW));
                userRequests.push(now);
                if(userRequests.length>RATE_LIMIT_REQUESTS){
                    showNotification('Too many requests—please wait.','error');
                    return Promise.resolve(false);
                }
                return Promise.resolve(true);
            }
        }

        class FraudDetection{
            static async detectFraud(userId,message){
                const hash=sha256(userId+message);
                if(responseCache.has(hash)){
                    showNotification('Duplicate request detected.','error');
                    return false;
                }
                return true;
            }
        }

        class WebSearch{
            static async search(query){
                const cacheKey=sha256(query);
                if(searchCache.has(cacheKey))return searchCache.get(cacheKey);
                try{
                    const response=await fetch(`${SEARCH_API_URL}?q=${encodeURIComponent(query)}`,{
                        headers:{'Authorization':`Bearer ${OPENAI_API_KEY}`}
                    });
                    const data=await response.json();
                    const result=data.results.slice(0,3).map(r=>r.snippet).join(' ');
                    searchCache.set(cacheKey,result);
                    return result;
                }catch(error){
                    return null;
                }
            }
        }

        class MediaProcessor{
            static async analyzeImage(file){
                const base64=await readImage(file);
                try{
                    const result=await processMediaWithWorker('processImage',{image:base64});
                    return result.description||'Image analyzed.';
                }catch(error){
                    showNotification('Image analysis failed.','error');
                    return 'Unable to analyze image.';
                }
            }

            static async analyzeVideo(file){
                try{
                    const result=await processMediaWithWorker('processVideo',{video:URL.createObjectURL(file)});
                    return result.description||'Video analyzed.';
                }catch(error){
                    showNotification('Video analysis failed.','error');
                    return 'Unable to analyze video.';
                }
            }

            static async generateImage(prompt){
                try{
                    const response=await fetch(DALLE_API_URL,{
                        method:'POST',
                        headers:{
                            'Authorization':`Bearer ${OPENAI_API_KEY}`,
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify({
                            prompt:prompt,
                            n:1,
                            size:'1024x1024'
                        })
                    });
                    const data=await response.json();
                    return data.data[0].url;
                }catch(error){
                    showNotification('Image generation failed.','error');
                    return 'https://via.placeholder.com/1024';
                }
            }

            static async generateVideo(prompt){
                try{
                    const response=await fetch(SORA_API_URL,{
                        method:'POST',
                        headers:{
                            'Authorization':`Bearer ${OPENAI_API_KEY}`,
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify({
                            prompt:prompt,
                            duration:10,
                            format:'mp4'
                        })
                    });
                    const data=await response.json();
                    return data.url;
                }catch(error){
                    showNotification('Video generation failed.','error');
                    return 'https://via.placeholder.com/1024.mp4';
                }
            }
        }

        function requestPermissions(){
            permissionModal.classList.add('open');
        }

        function prefetchResources(){
            const resources=[
                'https://api.openai.com/v1/models',
                'https://api.x.ai/v1/models',
                'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;600;700',
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css'
            ];
            resources.forEach((url,i)=>{
                setTimeout(()=>{
                    const link=document.createElement('link');
                    link.rel='prefetch';
                    link.href=url;
                    link.as=['font','style'].includes(url.split('.').pop())?'style':'fetch';
                    link.crossOrigin='anonymous';
                    document.head.appendChild(link);
                },i*100);
            });
        }

        async function handleFileUpload(files){
            filesArray=Array.from(files);
            fileList.innerHTML='';
            fileClearBtn.style.display=filesArray.length?'block':'none';
            for(const file of filesArray){
                const fileItem=document.createElement('div');
                fileItem.className='file-item';
                fileItem.innerHTML=`
                    <span class="file-item-name">${file.name}</span>
                    <span class="file-item-details">${(file.size/1024).toFixed(2)} KB</span>
                    <div class="file-progress" style="width:0%"></div>
                `;
                fileItem.addEventListener('click',()=>previewFile(file));
                fileList.appendChild(fileItem);
                const progressBar=fileItem.querySelector('.file-progress');
                let progress=0;
                const interval=setInterval(()=>{
                    progress+=10;
                    progressBar.style.width=`${progress}%`;
                    if(progress>=100)clearInterval(interval);
                },50);
            }
        }

        async function previewFile(file){
            filePreviewContent.innerHTML='';
            const fileType=file.type.split('/')[0];
            if(fileType==='image'){
                const img=document.createElement('img');
                img.src=URL.createObjectURL(file);
                filePreviewContent.appendChild(img);
            }else if(fileType==='video'){
                const video=document.createElement('video');
                video.src=URL.createObjectURL(file);
                video.controls=true;
                filePreviewContent.appendChild(video);
            }else{
                const text=await file.text();
                const pre=document.createElement('pre');
                pre.textContent=text;
                filePreviewContent.appendChild(pre);
            }
            filePreviewModal.classList.add('open');
        }

        async function readImage(file){
            return new Promise((resolve)=>{
                const reader=new FileReader();
                reader.onload=(e)=>resolve(e.target.result);
                reader.readAsDataURL(file);
            });
        }

        function addMessageToChat(message,role,timestamp=new Date().toLocaleTimeString()){
            const messageDiv=document.createElement('div');
            messageDiv.className=`chat-message ${role}`;
            let content=message;
            if(role==='ai'&&selectedAiModel==='codeMasterAI'&&message.includes('```')){
                const codeRegex=/```([\s\S]*?)```/g;
                let lastIndex=0;
                let formattedContent='';
                message.replace(codeRegex,(match,code,offset)=>{
                    formattedContent+=message.slice(lastIndex,offset);
                    formattedContent+=`<div class="code-block"><pre>${code}</pre><button class="copy-btn">Copy</button></div>`;
                    lastIndex=offset+match.length;
                    latestCodeBlocks.push(code);
                });
                formattedContent+=message.slice(lastIndex);
                content=formattedContent;
            }else{
                content=message.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
                              .replace(/\*(.*?)\*/g,'<em>$1</em>')
                              .replace(/`(.*?)`/g,'<code>$1</code>')
                              .replace(/\n/g,'orek;</br>')
                              .replace(/\|(.*?)\|(.*?)\|/g,(match,header,rows)=>{
                                  const headers=header.split(',').map(h=>`<th>${h.trim()}</th>`).join('');
                                  const rowData=rows.split(';').map(row=>{
                                      const cols=row.split(',').map(col=>`<td>${col.trim()}</td>`).join('');
                                      return `<tr>${cols}</tr>`;
                                  }).join('');
                                  return `<table><thead><tr>${headers}</tr></thead><tbody>${rowData}</tbody></table>`;
                              });
            }
            messageDiv.innerHTML=`<div class="chat-message-content">${content}</div><div class="chat-message-meta">${timestamp}</div>`;
            chatHistory.appendChild(messageDiv);
            chatArea.scrollTop=chatArea.scrollHeight;
            if(role==='ai'){
                const copyButtons=messageDiv.querySelectorAll('.copy-btn');
                copyButtons.forEach(btn=>{
                    btn.addEventListener('click',()=>{
                        const code=btn.previousElementSibling.textContent;
                        navigator.clipboard.writeText(code);
                        showNotification('Code copied!');
                    });
                });
            }
        }

        async function processMessage(message){
            if(!rateLimitCheck())return;
            const userId='user_'+Date.now();
            if(!await DDoSProtection.analyzeRequest(userId,{csrfToken:sha256(userId+OPENAI_API_KEY)}))return;
            if(!await FraudDetection.detectFraud(userId,message))return;
            if(verifyAdminAccess(message))return;
            if(message.toLowerCase().includes('play a music')||message.toLowerCase().includes('background music')){
                await playBackgroundMusic(message);
                return;
            }
            if(message.toLowerCase().includes('generate an image')&&selectedAiModel==='visualGeniusAI'){
                const prompt=message.replace(/generate an image/i,'').trim();
                const imageUrl=await MediaProcessor.generateImage(prompt);
                addMessageToChat(`<img src="${imageUrl}" alt="Generated Image">`,'ai');
                conversationHistory.push({role:"assistant",content:`Generated image: ${imageUrl}`});
                return;
            }
            if(message.toLowerCase().includes('generate a video')&&selectedAiModel==='visualGeniusAI'){
                const prompt=message.replace(/generate a video/i,'').trim();
                const videoUrl=await MediaProcessor.generateVideo(prompt);
                addMessageToChat(`<video src="${videoUrl}" controls></video>`,'ai');
                conversationHistory.push({role:"assistant",content:`Generated video: ${videoUrl}`});
                return;
            }
            let aiResponse=aiModels[selectedAiModel].personality;
            if(filesArray.length>0){
                for(const file of filesArray){
                    if(file.type.startsWith('image/')){
                        const analysis=await MediaProcessor.analyzeImage(file);
                        aiResponse+=`\nImage Analysis: ${analysis}`;
                    }else if(file.type.startsWith('video/')){
                        const analysis=await MediaProcessor.analyzeVideo(file);
                        aiResponse+=`\nVideo Analysis: ${analysis}`;
                    }else{
                        const text=await file.text();
                        aiResponse+=`\nFile Content: ${text}`;
                    }
                }
            }
            const searchResults=await WebSearch.search(message);
            if(searchResults)aiResponse+=`\nWeb Insights: ${searchResults}`;
            const cacheKey=sha256(message+JSON.stringify(conversationHistory));
            if(responseCache.has(cacheKey)){
                aiResponse=responseCache.get(cacheKey);
                addMessageToChat(aiResponse,'ai');
                return;
            }
            const messages=[
                {role:"system",content:aiModels[selectedAiModel].personality},
                ...conversationHistory,
                {role:"user",content:message}
            ];
            abortController=new AbortController();
            stopGeneratingBtn.style.display='block';
            try{
                const response=await fetch(aiModels[selectedAiModel].apiUrl,{
                    method:'POST',
                    headers:{
                        'Authorization':`Bearer ${aiModels[selectedAiModel].apiKey||OPENAI_API_KEY}`,
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({
                        model:selectedAiModel==='betterGrok'?'grok-3-beta':'gpt-4o',
                        messages:messages,
                        max_tokens:aiModels[selectedAiModel].maxTokens,
                        temperature:aiModels[selectedAiModel].temperature,
                        stream:true
                    }),
                    signal:abortController.signal
                });
                const reader=response.body.getReader();
                let result='';
                const decoder=new TextDecoder();
                addMessageToChat('','ai');
                const aiMessage=chatHistory.lastElementChild;
                const contentDiv=aiMessage.querySelector('.chat-message-content');
                while(true){
                    const{done,value}=await reader.read();
                    if(done)break;
                    const chunk=decoder.decode(value);
                    const lines=chunk.split('\n').filter(line=>line.startsWith('data:'));
                    for(const line of lines){
                        if(line==='data: [DONE]')break;
                        const json=line.replace('data: ','');
                        const data=JSON.parse(json);
                        const delta=data.choices[0].delta.content;
                        if(delta){
                            result+=delta;
                            contentDiv.textContent=result;
                            chatArea.scrollTop=chatArea.scrollHeight;
                        }
                    }
                }
                aiResponse=result;
                responseCache.set(cacheKey,aiResponse);
                cacheSize+=aiResponse.length;
                if(cacheSize>MAX_CACHE_SIZE){
                    const oldestKey=responseCache.keys().next().value;
                    responseCache.delete(oldestKey);
                    cacheSize-=oldestKey.length;
                }
                conversationHistory.push({role:"assistant",content:aiResponse});
                saveConversation(message,aiResponse);
                latestAiResponse=aiResponse;
            }catch(error){
                if(error.name==='AbortError'){
                    showNotification('Generation stopped.');
                }else{
                    showNotification('Error processing request.','error');
                }
            }finally{
                stopGeneratingBtn.style.display='none';
                abortController=null;
                isGenerating=false;
                generationLock=false;
                processNextMessage();
            }
        }

        function processNextMessage(){
            if(isProcessing||!messageQueue.size)return;
            isProcessing=true;
            const nextMessage=messageQueue.entries().next().value;
            if(!nextMessage){
                isProcessing=false;
                return;
            }
            const[messageId,message]=nextMessage;
            messageQueue.delete(messageId);
            addMessageToChat(message,'user');
            conversationHistory.push({role:"user",content:message});
            loadingSpinner.style.display='block';
            typingIndicator.style.display='block';
            setTimeout(async()=>{
                await processMessage(message);
                loadingSpinner.style.display='none';
                typingIndicator.style.display='none';
                isProcessing=false;
                processNextMessage();
            },100);
        }

        function handleSendMessage(){
            const message=userInput.value.trim();
            if(!message||generationLock)return;
            generationLock=true;
            userInput.value='';
            userInput.style.height='auto';
            const messageId=Date.now().toString();
            messageQueue.set(messageId,message);
            processNextMessage();
        }

        userInput.addEventListener('input',()=>{
            userInput.style.height='auto';
            userInput.style.height=`${userInput.scrollHeight}px`;
            sendBtn.disabled=!userInput.value.trim()&&!filesArray.length;
        });

        userInput.addEventListener('keypress',(e)=>{
            if(e.key==='Enter'&&!e.shiftKey){
                e.preventDefault();
                handleSendMessage();
            }
        });

        sendBtn.addEventListener('click',handleSendMessage);

        fileInput.addEventListener('change',async(e)=>{
            if(!hasPermission){
                requestPermissions();
                return;
            }
            await handleFileUpload(e.target.files);
        });

        fileClearBtn.addEventListener('click',()=>{
            filesArray=[];
            fileList.innerHTML='';
            fileClearBtn.style.display='none';
        });

        filePreviewClose.addEventListener('click',()=>{
            filePreviewModal.classList.remove('open');
            filePreviewContent.innerHTML='';
        });

        menuBtn.addEventListener('click',()=>{
            sidebar.classList.add('open');
        });

        sidebarClose.addEventListener('click',()=>{
            sidebar.classList.remove('open');
        });

        clearChatBtn.addEventListener('click',()=>{
            chatHistory.innerHTML='';
            conversationHistory=[{role:"assistant",content:aiModels[selectedAiModel].personality}];
            addMessageToChat(aiModels[selectedAiModel].personality,'ai');
            sidebar.classList.remove('open');
        });

        copyCodeBtn.addEventListener('click',()=>{
            if(latestCodeBlocks.length){
                navigator.clipboard.writeText(latestCodeBlocks[latestCodeBlocks.length-1]);
                showNotification('Code copied!');
            }else{
                showNotification('No code to copy.','error');
            }
            sidebar.classList.remove('open');
        });

        discordBtn.addEventListener('click',()=>{
            window.open(DISCORD_INVITE,'_blank');
            sidebar.classList.remove('open');
        });

        verbiflowUpdatesBtn.addEventListener('click',()=>{
            addMessageToChat('VerbiFlow Updates: Enhanced AI models, faster responses, and new features like Discord bot hosting with Helper!','ai');
            sidebar.classList.remove('open');
        });

        premiumPriceBtn.addEventListener('click',()=>{
            addMessageToChat('Please visit our pricing page for premium details: [Pricing Page](#).','ai');
            sidebar.classList.remove('open');
        });

        shareChatBtn.addEventListener('click',()=>{
            const chatContent=conversationHistory.map(msg=>`${msg.role}: ${msg.content}`).join('\n');
            navigator.clipboard.writeText(chatContent);
            showNotification('Chat copied to clipboard!');
            sidebar.classList.remove('open');
        });

        shareWebsiteBtn.addEventListener('click',()=>{
            navigator.clipboard.writeText(window.location.href);
            showNotification('Website URL copied to clipboard!');
            sidebar.classList.remove('open');
        });

        themeBtn.addEventListener('click',()=>{
            toggleTheme();
            sidebar.classList.remove('open');
        });

        openInAppBtn.addEventListener('click',()=>{
            window.open(APP_URL,'_blank');
            sidebar.classList.remove('open');
        });

        toggleActionsBtn.addEventListener('click',()=>{
            fileActionsContainer.classList.toggle('collapsed');
            toggleActionsBtn.classList.toggle('collapsed');
        });

        generateMediaBtn.addEventListener('click',()=>{
            if(selectedAiModel!=='visualGeniusAI'){
                showNotification('Switch to VisualGeniusAI for media generation.','error');
                return;
            }
            const prompt=userInput.value.trim()||'Generate a random image';
            messageQueue.set(Date.now().toString(),`Generate an image: ${prompt}`);
            processNextMessage();
        });

        voiceSearchBtn.addEventListener('click',()=>{
            if(!hasPermission){
                requestPermissions();
                return;
            }
            if(!('webkitSpeechRecognition' in window)){
                showNotification('Speech recognition not supported.','error');
                return;
            }
            recognition=new webkitSpeechRecognition();
            recognition.continuous=false;
            recognition.interimResults=false;
            recognition.lang=selectedLanguage;
            recognition.start();
            recognition.onresult=(event)=>{
                const transcript=event.results[0][0].transcript;
                userInput.value=transcript;
                handleSendMessage();
            };
            recognition.onerror=(event)=>{
                showNotification(`Speech recognition error: ${event.error}`,'error');
            };
        });

        schoolHelpDropdown.addEventListener('change',()=>{
            selectedSchoolMode=schoolHelpDropdown.value;
            if(selectedSchoolMode){
                const prompt=selectedSchoolMode==='discordBot'?'Set up a Discord bot with Helper.':`Help with ${selectedSchoolMode}.`;
                messageQueue.set(Date.now().toString(),prompt);
                processNextMessage();
            }
        });

        aiModelDropdown.addEventListener('change',()=>{
            selectedAiModel=aiModelDropdown.value;
            clearChatBtn.click();
        });

        languageDropdown.addEventListener('change',()=>{
            selectedLanguage=languageDropdown.value;
            if(conversationHistory.length>1){
                const lastMessage=conversationHistory[conversationHistory.length-1].content;
                translateText(lastMessage,selectedLanguage).then(translated=>{
                    addMessageToChat(translated,'ai');
                });
            }
        });

        rephraseBtn.addEventListener('click',()=>{
            if(!latestAiResponse){
                showNotification('No response to rephrase.','error');
                return;
            }
            messageQueue.set(Date.now().toString(),`Rephrase this: ${latestAiResponse}`);
            processNextMessage();
        });

        stopGeneratingBtn.addEventListener('click',()=>{
            if(abortController){
                abortController.abort();
            }
        });

        feedbackBtn.addEventListener('click',()=>{
            feedbackModal.classList.add('open');
        });

        feedbackSubmitBtn.addEventListener('click',()=>{
            const feedback=feedbackInput.value.trim();
            if(feedback){
                Email.send({
                    Host:"smtp.elasticemail.com",
                    Username:"your_smtp_username",
                    Password:"your_smtp_password",
                    To:FEEDBACK_EMAIL,
                    From:"noreply@verbiflow.com",
                    Subject:"VerbiFlow User Feedback",
                    Body:`Feedback: ${feedback}\n\nTimestamp: ${new Date().toISOString()}`
                }).then(()=>{
                    showNotification('Thank you for your feedback!');
                    feedbackModal.classList.remove('open');
                    feedbackInput.value='';
                }).catch(err=>{
                    showNotification('Failed to send feedback.','error');
                });
            }else{
                showNotification('Please enter feedback.','error');
            }
        });

        grantPermissionBtn.addEventListener('click',()=>{
            hasPermission=true;
            permissionModal.classList.remove('open');
            showNotification('Permissions granted!');
        });

        denyPermissionBtn.addEventListener('click',()=>{
            hasPermission=false;
            permissionModal.classList.remove('open');
            showNotification('Permissions denied.','error');
        });

        window.addEventListener('paste',async(e)=>{
            const items=e.clipboardData.items;
            for(const item of items){
                if(item.type.startsWith('image/')){
                    const file=item.getAsFile();
                    const hash=sha256(await file.text());
                    if(pastedImageHashes.has(hash))continue;
                    pastedImageHashes.add(hash);
                    await handleFileUpload([file]);
                    messageQueue.set(Date.now().toString(),`Analyze this image.`);
                    processNextMessage();
                }
            }
        });

        window.addEventListener('resize',()=>{
            userInput.style.height='auto';
            userInput.style.height=`${userInput.scrollHeight}px`;
        });

        document.addEventListener('DOMContentLoaded',()=>{
            loadTheme();
            initializeDB();
            loadConversations();
            initializeWorkerPool();
            prefetchResources();
        });
    </script>
</body>
</html>
