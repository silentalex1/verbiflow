<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prysmis AI - AI Coding Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
:root {
    --primary: #8b5cf6;
    --primary-hover: #7c3aed;
    --secondary: #10b981;
    --dark: #1e293b;
    --light: #f8fafc;
    --gray: #64748b;
}

body {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    min-height: 100vh;
    margin: 0;
    font-family: 'Inter', sans-serif;
    color: #e2e8f0;
    overflow-x: hidden;
    overflow-y: auto;
    transition: background 0.2s ease;
}

body.light-mode {
    background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
    color: #1f2937;
}

.app-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    transition: padding 0.2s ease;
}

@media (max-width: 640px) {
    .app-container {
        padding: 1rem;
    }
}

.glass-card {
    background: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(25px);
    border-radius: 30px;
    box-shadow: 0 20px 70px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.2);
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

body.light-mode .glass-card {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 20px 70px rgba(0, 0, 0, 0.2);
}

.glass-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 25px 90px rgba(0, 0, 0, 0.6);
}

.section-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    transition: gap 0.2s ease;
}

.tab {
    padding: 0.8rem 1.6rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 9999px;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
}

body.light-mode .tab {
    background: rgba(0, 0, 0, 0.1);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
}

@media (max-width: 640px) {
    .tab {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
    }
}

.tab.active {
    background: var(--primary);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.7);
    transform: scale(1.15);
}

.tab:hover:not(.active) {
    background: rgba(255, 255, 255, 0.35);
    transform: scale(1.05);
}

body.light-mode .tab:hover:not(.active) {
    background: rgba(0, 0, 0, 0.15);
}

.editor-container, .general-container, .homework-container {
    display: none;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    height: 500px;
    transition: gap 0.2s ease;
    background: rgba(15, 23, 42, 0.3);
    border-radius: 25px;
    padding: 1rem;
}

body.light-mode .editor-container, body.light-mode .general-container, body.light-mode .homework-container {
    background: rgba(229, 231, 235, 0.3);
}

@media (max-width: 768px) {
    .editor-container, .general-container, .homework-container {
        grid-template-columns: 1fr;
        height: auto;
        gap: 1rem;
    }
}

.editor-container.active, .general-container.active, .homework-container.active {
    display: grid;
}

.editor-container:hover, .general-container:hover, .homework-container:hover {
    gap: 2.5rem;
}

@media (max-width: 768px) {
    .editor-container:hover, .general-container:hover, .homework-container:hover {
        gap: 1.5rem;
    }
}

.code-area, .general-area, .homework-area {
    position: relative;
    height: 100%;
    transition: transform 0.2s ease;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    background: linear-gradient(135deg, #1a1a3a, #2a2a5a);
}

body.light-mode .code-area, body.light-mode .general-area, body.light-mode .homework-area {
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
}

@media (max-width: 768px) {
    .code-area, .general-area, .homework-area {
        height: 300px;
    }
}

.code-area:hover, .general-area:hover, .homework-area:hover {
    transform: scale(1.02);
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
}

body.light-mode .code-area:hover, body.light-mode .general-area:hover, body.light-mode .homework-area:hover {
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: linear-gradient(90deg, #1a1a3a, #2a2a5a);
    border-radius: 20px 20px 0 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.25);
    transition: background 0.2s ease;
}

body.light-mode .code-header {
    background: linear-gradient(90deg, #e5e7eb, #d1d5db);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

@media (max-width: 640px) {
    .code-header {
        padding: 0.8rem 1rem;
    }
}

.code-header:hover {
    background: linear-gradient(90deg, #2a2a5a, #3a3a7a);
}

body.light-mode .code-header:hover {
    background: linear-gradient(90deg, #d1d5db, #b9c1cc);
}

.code-textarea, .general-textarea, .homework-textarea {
    width: 100%;
    height: calc(100% - 60px);
    padding: 1.5rem;
    border: none;
    background: transparent;
    color: #e2e8f0;
    font-family: 'Fira Code', monospace;
    font-size: 1rem;
    line-height: 1.8;
    resize: none;
    border-radius: 0 0 20px 20px;
    outline: none;
    transition: all 0.2s ease;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #8b5cf6 rgba(255, 255, 255, 0.15);
}

body.light-mode .code-textarea, body.light-mode .general-textarea, body.light-mode .homework-textarea {
    color: #1f2937;
    scrollbar-color: #8b5cf6 rgba(0, 0, 0, 0.15);
}

@media (max-width: 640px) {
    .code-textarea, .general-textarea, .homework-textarea {
        padding: 1rem;
        font-size: 0.9rem;
        height: calc(100% - 50px);
    }
}

.code-textarea::-webkit-scrollbar, .general-textarea::-webkit-scrollbar, .homework-textarea::-webkit-scrollbar {
    width: 10px;
}

.code-textarea::-webkit-scrollbar-track, .general-textarea::-webkit-scrollbar-track, .homework-textarea::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.15);
}

body.light-mode .code-textarea::-webkit-scrollbar-track, body.light-mode .general-textarea::-webkit-scrollbar-track, body.light-mode .homework-textarea::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
}

.code-textarea::-webkit-scrollbar-thumb, .general-textarea::-webkit-scrollbar-thumb, .homework-textarea::-webkit-scrollbar-thumb {
    background: #8b5cf6;
    border-radius: 5px;
}

.code-textarea:focus, .general-textarea:focus, .homework-textarea:focus {
    box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.6);
    background: rgba(30, 41, 59, 0.4);
}

body.light-mode .code-textarea:focus, body.light-mode .general-textarea:focus, body.light-mode .homework-textarea:focus {
    background: rgba(229, 231, 235, 0.4);
}

.code-textarea::placeholder, .general-textarea::placeholder, .homework-textarea::placeholder {
    color: #94a3b8;
    font-style: italic;
}

body.light-mode .code-textarea::placeholder, body.light-mode .general-textarea::placeholder, body.light-mode .homework-textarea::placeholder {
    color: #6b7280;
}

#codeOutput, #generalOutput, #homeworkOutput {
    white-space: pre-wrap;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #8b5cf6 rgba(255, 255, 255, 0.15);
}

body.light-mode #codeOutput, body.light-mode #generalOutput, body.light-mode #homeworkOutput {
    scrollbar-color: #8b5cf6 rgba(0, 0, 0, 0.15);
}

#codeOutput::-webkit-scrollbar, #generalOutput::-webkit-scrollbar, #homeworkOutput::-webkit-scrollbar {
    width: 10px;
}

#codeOutput::-webkit-scrollbar-track, #generalOutput::-webkit-scrollbar-track, #homeworkOutput::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.15);
}

body.light-mode #codeOutput::-webkit-scrollbar-track, body.light-mode #generalOutput::-webkit-scrollbar-track, body.light-mode #homeworkOutput::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
}

#codeOutput::-webkit-scrollbar-thumb, #generalOutput::-webkit-scrollbar-thumb, #homeworkOutput::-webkit-scrollbar-thumb {
    background: #8b5cf6;
    border-radius: 5px;
}

#codeOutput .keyword {
    color: #ff79c6;
    font-weight: bold;
    text-shadow: 0 0 6px rgba(255, 121, 198, 0.7);
}

body.light-mode #codeOutput .keyword {
    text-shadow: none;
}

#codeOutput .string {
    color: #f1fa8c;
    font-style: italic;
    text-shadow: 0 0 5px rgba(241, 250, 140, 0.7);
}

body.light-mode #codeOutput .string {
    text-shadow: none;
}

#codeOutput .comment {
    color: #6272a4;
    font-style: italic;
    text-shadow: 0 0 4px rgba(98, 114, 164, 0.7);
}

body.light-mode #codeOutput .comment {
    color: #6b7280;
    text-shadow: none;
}

#codeOutput .function {
    color: #50fa7b;
    font-weight: bold;
    text-shadow: 0 0 7px rgba(80, 250, 123, 0.7);
}

body.light-mode #codeOutput .function {
    text-shadow: none;
}

#codeOutput .number {
    color: #bd93f9;
    font-weight: bold;
    text-shadow: 0 0 5px rgba(189, 147, 249, 0.7);
}

body.light-mode #codeOutput .number {
    text-shadow: none;
}

#codeOutput .operator {
    color: #ff5555;
    font-weight: bold;
    text-shadow: 0 0 5px rgba(255, 85, 85, 0.7);
}

body.light-mode #codeOutput .operator {
    text-shadow: none;
}

.btn-primary {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 1rem 2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
    position: relative;
    overflow: hidden;
}

body.light-mode .btn-primary {
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
}

@media (max-width: 640px) {
    .btn-primary {
        padding: 0.8rem 1.5rem;
        font-size: 0.9rem;
    }
}

.btn-primary:hover {
    background: var(--primary-hover);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(139, 92, 246, 0.7);
}

body.light-mode .btn-primary:hover {
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.7);
}

.btn-primary:active {
    transform: translateY(0);
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

body.light-mode .btn-primary:active {
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.feature-button {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 10px;
    padding: 0.7rem;
    color: #e2e8f0;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
}

body.light-mode .feature-button {
    background: rgba(0, 0, 0, 0.1);
    color: #1f2937;
}

@media (max-width: 640px) {
    .feature-button {
        padding: 0.5rem;
    }
}

.feature-button:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: scale(1.2);
}

body.light-mode .feature-button:hover {
    background: rgba(0, 0, 0, 0.15);
}

.status-badge {
    background: rgba(16, 185, 129, 0.3);
    color: #10b981;
    font-size: 0.85rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    transition: background 0.2s ease;
}

body.light-mode .status-badge {
    background: rgba(16, 185, 129, 0.2);
}

@media (max-width: 640px) {
    .status-badge {
        font-size: 0.75rem;
        padding: 0.3rem 0.8rem;
    }
}

.status-badge:hover {
    background: rgba(16, 185, 129, 0.6);
}

body.light-mode .status-badge:hover {
    background: rgba(16, 185, 129, 0.4);
}

.pulsing-dot {
    width: 10px;
    height: 10px;
    background-color: #10b981;
    border-radius: 50%;
    animation: pulse 0.8s infinite;
}

@keyframes pulse {
    0% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.8); }
    70% { transform: scale(1); box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
    100% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
}

.footer {
    margin-top: 3rem;
    text-align: center;
    font-size: 0.95rem;
    color: #94a3b8;
    transition: opacity 0.2s ease;
}

body.light-mode .footer {
    color: #6b7280;
}

@media (max-width: 640px) {
    .footer {
        font-size: 0.85rem;
        margin-top: 2rem;
    }
}

.footer:hover {
    opacity: 0.9;
}

.language-selector {
    display: flex;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    transition: gap 0.2s ease;
}

.language-pill {
    padding: 0.7rem 1.5rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 9999px;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
}

body.light-mode .language-pill {
    background: rgba(0, 0, 0, 0.1);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
}

@media (max-width: 640px) {
    .language-pill {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
    }
}

.language-pill.active {
    background: var(--primary);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.7);
    transform: scale(1.15);
}

.language-pill:hover:not(.active) {
    background: rgba(255, 255, 255, 0.35);
    transform: scale(1.05);
}

body.light-mode .language-pill:hover:not(.active) {
    background: rgba(0, 0, 0, 0.15);
}

.admin-badge {
    background: rgba(234, 179, 8, 0.3);
    color: #eab308;
    font-size: 0.85rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    margin-left: 1rem;
}

body.light-mode .admin-badge {
    background: rgba(234, 179, 8, 0.2);
}

@media (max-width: 640px) {
    .admin-badge {
        font-size: 0.75rem;
        padding: 0.3rem 0.8rem;
        margin-left: 0.5rem;
    }
}

.admin-badge i {
    font-size: 1rem;
}

.signout-btn {
    background: rgba(255, 69, 58, 0.3);
    color: #ff453a;
    font-size: 0.85rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    margin-left: 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
}

body.light-mode .signout-btn {
    background: rgba(255, 69, 58, 0.2);
    color: #dc2626;
}

@media (max-width: 640px) {
    .signout-btn {
        font-size: 0.75rem;
        padding: 0.3rem 0.8rem;
        margin-left: 0.5rem;
    }
}

.signout-btn:hover {
    background: rgba(255, 69, 58, 0.6);
}

body.light-mode .signout-btn:hover {
    background: rgba(255, 69, 58, 0.4);
}

.admin-panel-btn {
    background: rgba(234, 88, 12, 0.3);
    color: #ea580c;
    font-size: 0.85rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    margin-left: 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
}

body.light-mode .admin-panel-btn {
    background: rgba(234, 88, 12, 0.2);
    color: #c2410c;
}

@media (max-width: 640px) {
    .admin-panel-btn {
        font-size: 0.75rem;
        padding: 0.3rem 0.8rem;
        margin-left: 0.5rem;
    }
}

.admin-panel-btn:hover {
    background: rgba(234, 88, 12, 0.6);
}

body.light-mode .admin-panel-btn:hover {
    background: rgba(234, 88, 12, 0.4);
}

.theme-toggle-btn {
    background: rgba(255, 255, 255, 0.2);
    color: #e2e8f0;
    font-size: 0.85rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    margin-left: 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
}

body.light-mode .theme-toggle-btn {
    background: rgba(0, 0, 0, 0.1);
    color: #1f2937;
}

@media (max-width: 640px) {
    .theme-toggle-btn {
        font-size: 0.75rem;
        padding: 0.3rem 0.8rem;
        margin-left: 0.5rem;
    }
}

.theme-toggle-btn:hover {
    background: rgba(255, 255, 255, 0.4);
}

body.light-mode .theme-toggle-btn:hover {
    background: rgba(0, 0, 0, 0.15);
}

.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 2rem;
    transition: gap 0.2s ease;
}

@media (max-width: 640px) {
    .header-container {
        flex-direction: column;
        align-items: flex-start;
    }
}

.header-left {
    display: flex;
    align-items: center;
    gap: 1rem;
}

@media (max-width: 640px) {
    .header-left {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}

.header-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

@media (max-width: 640px) {
    .header-right {
        gap: 0.3rem;
    }
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2.5rem;
    transition: gap 0.2s ease;
}

@media (max-width: 768px) {
    .features-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

.feature-card {
    padding: 1.5rem;
    text-align: center;
    transition: padding 0.2s ease;
}

@media (max-width: 640px) {
    .feature-card {
        padding: 1rem;
    }
}

.feature-card h3 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

@media (max-width: 640px) {
    .feature-card h3 {
        font-size: 1rem;
    }
}

.feature-card p {
    font-size: 0.85rem;
}

body.light-mode .feature-card p {
    color: #6b7280;
}

@media (max-width: 640px) {
    .feature-card p {
        font-size: 0.75rem;
    }
}

.button-group {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
    padding: 1.5rem;
    transition: gap 0.2s ease;
}

@media (max-width: 640px) {
    .button-group {
        gap: 0.5rem;
        padding: 1rem;
    }
}

.progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.5rem;
    display: none;
    transition: opacity 0.2s ease;
}

body.light-mode .progress-bar {
    background: rgba(0, 0, 0, 0.1);
}

.progress-bar.active {
    display: block;
}

.progress-bar-fill {
    width: 0;
    height: 100%;
    background: #8b5cf6;
    transition: width 0.02s linear;
}

.retry-btn {
    background: rgba(234, 88, 12, 0.3);
    color: #ea580c;
    font-size: 0.85rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    display: none;
    align-items: center;
    gap: 0.4rem;
    margin-top: 0.5rem;
    cursor: pointer;
    transition: background 0.2s ease;
}

body.light-mode .retry-btn {
    background: rgba(234, 88, 12, 0.2);
    color: #c2410c;
}

.retry-btn:hover {
    background: rgba(234, 88, 12, 0.6);
}

body.light-mode .retry-btn:hover {
    background: rgba(234, 88, 12, 0.4);
}

.slogan {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 600;
    color: #e2e8f0;
    margin-bottom: 2rem;
    background: linear-gradient(90deg, #8b5cf6, #6b46c1);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 0 10px rgba(139, 92, 246, 0.3);
    transition: opacity 0.2s ease;
}

body.light-mode .slogan {
    color: #1f2937;
}

@media (max-width: 640px) {
    .slogan {
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
    }
}
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header-container">
            <div class="header-left">
                <div class="text-primary text-4xl">
                    <i class="fas fa-code"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold sm:text-2xl">Prysmis AI</h1>
                    <p class="text-gray-400 text-sm sm:text-xs">AI-Powered Code Assistant | Welcome, <span id="welcomeUsername"></span></p>
                </div>
            </div>
            <div class="header-right">
                <div class="status-badge">
                    <span class="pulsing-dot"></span>
                    <span>API Connected</span>
                </div>
                <div id="adminBadge" class="admin-badge" style="display: none;">
                    <i class="fas fa-crown"></i>
                    <span>Admin</span>
                </div>
                <div id="signoutBtn" class="signout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sign Out</span>
                </div>
                <div id="adminPanelBtn" class="admin-panel-btn" style="display: none;">
                    <i class="fas fa-tools"></i>
                    <span>Admin Panel</span>
                </div>
                <div id="themeToggleBtn" class="theme-toggle-btn">
                    <i class="fas fa-moon"></i>
                    <span>Toggle Theme</span>
                </div>
            </div>
        </header>

        <div class="slogan">Pyrsmis - the #1 best free AI.</div>

        <div class="section-tabs">
            <div class="tab active" data-section="coding" role="tab">Code Processing</div>
            <div class="tab" data-section="general" role="tab">General</div>
            <div class="tab" data-section="homework" role="tab">Homework</div>
        </div>

        <div class="language-selector">
            <div class="language-pill active" data-lang="javascript">JavaScript</div>
            <div class="language-pill" data-lang="python">Python</div>
            <div class="language-pill" data-lang="lua">Lua</div>
            <div class="language-pill" data-lang="ruby">Ruby</div>
            <div class="language-pill" data-lang="go">Go</div>
            <div class="language-pill" data-lang="java">Java</div>
            <div class="language-pill" data-lang="cpp">C++</div>
        </div>

        <div class="glass-card mb-8">
            <div class="p-5">
                <h2 class="text-2xl font-semibold mb-3 sm:text-xl">Code Processing</h2>
                <p class="text-sm text-gray-400 sm:text-xs">Paste your code or a URL to fetch code for optimization, debugging, explanation, obfuscation, deobfuscation, improvements, or homework assistance.</p>
            </div>
            
            <div class="editor-container active" id="codingSection">
                <div class="code-area">
                    <div class="code-header">
                        <span class="text-sm font-medium sm:text-xs">Input Code</span>
                        <div class="flex gap-2">
                            <button class="feature-button clear-btn" title="Clear" aria-label="Clear input">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button class="feature-button copy-input-btn" title="Copy" aria-label="Copy input">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <textarea id="codeInput" class="code-textarea" placeholder="Enter your code or a URL to fetch code..." aria-label="Input code"></textarea>
                </div>
                
                <div class="code-area">
                    <div class="code-header">
                        <span class="text-sm font-medium sm:text-xs">Result</span>
                        <div class="flex gap-2">
                            <button class="feature-button copy-output-btn" title="Copy to Clipboard" aria-label="Copy output">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="feature-button download-btn" title="Download" aria-label="Download output">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div id="codeOutput" class="code-textarea" aria-live="polite">Results will appear here...</div>
                    <div class="progress-bar" id="codeProgressBar">
                        <div class="progress-bar-fill" id="codeProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryCodeBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>

            <div class="general-container" id="generalSection">
                <div class="general-area">
                    <div class="code-header">
                        <span class="text-sm font-medium sm:text-xs">Input Query</span>
                        <div class="flex gap-2">
                            <button class="feature-button clear-general-btn" title="Clear" aria-label="Clear input">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button class="feature-button copy-general-input-btn" title="Copy" aria-label="Copy input">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <textarea id="generalInput" class="general-textarea" placeholder="Ask anything here..." aria-label="Input query"></textarea>
                </div>
                
                <div class="general-area">
                    <div class="code-header">
                        <span class="text-sm font-medium sm:text-xs">Response</span>
                        <div class="flex gap-2">
                            <button class="feature-button copy-general-output-btn" title="Copy to Clipboard" aria-label="Copy output">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="feature-button download-general-btn" title="Download" aria-label="Download output">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div id="generalOutput" class="general-textarea" aria-live="polite">Responses will appear here...</div>
                    <div class="progress-bar" id="generalProgressBar">
                        <div class="progress-bar-fill" id="generalProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryGeneralBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>

            <div class="homework-container" id="homeworkSection">
                <div class="homework-area">
                    <div class="code-header">
                        <span class="text-sm font-medium sm:text-xs">Homework Input</span>
                        <div class="flex gap-2">
                            <button class="feature-button clear-homework-btn" title="Clear" aria-label="Clear input">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            <button class="feature-button copy-homework-input-btn" title="Copy" aria-label="Copy input">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <textarea id="homeworkInput" class="homework-textarea" placeholder="Enter your homework problem or code..." aria-label="Input homework"></textarea>
                </div>
                
                <div class="homework-area">
                    <div class="code-header">
                        <span class="text-sm font-medium sm:text-xs">Solution</span>
                        <div class="flex gap-2">
                            <button class="feature-button copy-homework-output-btn" title="Copy to Clipboard" aria-label="Copy output">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="feature-button download-homework-btn" title="Download" aria-label="Download output">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div id="homeworkOutput" class="homework-textarea" aria-live="polite">Solutions will appear here...</div>
                    <div class="progress-bar" id="homeworkProgressBar">
                        <div class="progress-bar-fill" id="homeworkProgressFill"></div>
                    </div>
                    <button class="retry-btn" id="retryHomeworkBtn">
                        <i class="fas fa-redo"></i>
                        <span>Retry</span>
                    </button>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" id="processBtn" aria-label="Optimize code">
                    <i class="fas fa-magic"></i>
                    <span>Optimize</span>
                </button>
                <button class="btn-primary" id="debugBtn" aria-label="Debug code">
                    <i class="fas fa-bug"></i>
                    <span>Debug</span>
                </button>
                <button class="btn-primary" id="explainBtn" aria-label="Explain code">
                    <i class="fas fa-info-circle"></i>
                    <span>Explain</span>
                </button>
                <button class="btn-primary" id="obfuscateBtn" aria-label="Obfuscate code">
                    <i class="fas fa-lock"></i>
                    <span>Obfuscate</span>
                </button>
                <button class="btn-primary" id="deobfuscateBtn" aria-label="Deobfuscate code">
                    <i class="fas fa-unlock"></i>
                    <span>Deobfuscate</span>
                </button>
                <button class="btn-primary" id="improveBtn" aria-label="Improve code">
                    <i class="fas fa-wrench"></i>
                    <span>Code Improvements</span>
                </button>
                <button class="btn-primary" id="homeworkBtn" aria-label="Solve homework">
                    <i class="fas fa-book"></i>
                    <span>Homework Help</span>
                </button>
                <button class="btn-primary" id="generalBtn" style="display: none;" aria-label="Ask query">
                    <i class="fas fa-question-circle"></i>
                    <span>Ask</span>
                </button>
            </div>
        </div>
        
        <div class="features-grid">
            <div class="glass-card feature-card">
                <i class="fas fa-bolt text-yellow-400 text-3xl mb-3 sm:text-2xl"></i>
                <h3 class="font-medium mb-2">Performance Boost</h3>
                <p class="text-sm text-gray-400">Increase code speed</p>
            </div>
            <div class="glass-card feature-card">
                <i class="fas fa-code-branch text-blue-400 text-3xl mb-3 sm:text-2xl"></i>
                <h3 class="font-medium mb-2">Clean Code</h3>
                <p class="text-sm text-gray-400">Improve readability</p>
            </div>
            <div class="glass-card feature-card">
                <i class="fas fa-shield-alt text-green-400 text-3xl mb-3 sm:text-2xl"></i>
                <h3 class="font-medium mb-2">Bug Fix</h3>
                <p class="text-sm text-gray-400">Detect and resolve issues</p>
            </div>
        </div>
        
        <footer class="footer">
            <p>Prysmis AI © 2025 • Powered by Prysmis Technologies</p>
        </footer>
    </div>
    <script>
const codeInput = document.getElementById('codeInput');
const generalInput = document.getElementById('generalInput');
const homeworkInput = document.getElementById('homeworkInput');
const processBtn = document.getElementById('processBtn');
const debugBtn = document.getElementById('debugBtn');
const explainBtn = document.getElementById('explainBtn');
const obfuscateBtn = document.getElementById('obfuscateBtn');
const deobfuscateBtn = document.getElementById('deobfuscateBtn');
const improveBtn = document.getElementById('improveBtn');
const homeworkBtn = document.getElementById('homeworkBtn');
const generalBtn = document.getElementById('generalBtn');
const codeOutput = document.getElementById('codeOutput');
const generalOutput = document.getElementById('generalOutput');
const homeworkOutput = document.getElementById('homeworkOutput');
const codeProgressBar = document.getElementById('codeProgressBar');
const codeProgressFill = document.getElementById('codeProgressFill');
const generalProgressBar = document.getElementById('generalProgressBar');
const generalProgressFill = document.getElementById('generalProgressFill');
const homeworkProgressBar = document.getElementById('homeworkProgressBar');
const homeworkProgressFill = document.getElementById('homeworkProgressFill');
const retryCodeBtn = document.getElementById('retryCodeBtn');
const retryGeneralBtn = document.getElementById('retryGeneralBtn');
const retryHomeworkBtn = document.getElementById('retryHomeworkBtn');
const themeToggleBtn = document.getElementById('themeToggleBtn');
const welcomeUsername = document.getElementById('welcomeUsername');
const apiKey = localStorage.getItem('apiKey');
const username = localStorage.getItem('username') || 'Guest';
const codingSection = document.getElementById('codingSection');
const generalSection = document.getElementById('generalSection');
const homeworkSection = document.getElementById('homeworkSection');
const adminBadge = document.getElementById('adminBadge');
const signoutBtn = document.getElementById('signoutBtn');
const adminPanelBtn = document.getElementById('adminPanelBtn');
let conversationHistory = JSON.parse(localStorage.getItem('conversationHistory')) || [];
let blacklistedUsers = JSON.parse(localStorage.getItem('blacklistedUsers')) || [];
let responseCache = JSON.parse(localStorage.getItem('responseCache')) || {};
let rateLimit = { requests: 0, windowStart: Date.now(), limit: 200, window: 60 * 1000 };
const aiSettings = {
    prompt: 'You are Prysmis AI, an elite coding assistant powered by GPT-4o, mastering ultra-precise optimization, exhaustive debugging, in-depth explanations, advanced obfuscation, and sophisticated deobfuscation of complex code (e.g., MoonSec with bytecode transformation, string encryption, control flow obfuscation, anti-debugging, and packing). Fetch code from external websites with robust parsing and error recovery, deliver lightning-fast, pristine, and highly accurate responses with multi-dimensional contextual analysis. Utilize cutting-edge algorithms for code transformation, error detection, performance optimization, security hardening, and scalability enhancement. For homework, provide meticulous step-by-step solutions with mathematical proofs, algorithmic derivations, and educational depth across mathematics, physics, computer science, and engineering.',
    model: 'gpt-4o',
    maxTokens: 20000,
    temperature: 0.002,
    contextWindow: 250,
    topP: 0.99,
    frequencyPenalty: 0.2,
    presencePenalty: 0.2
};

function validateApiKey(key) {
    return fetch('https://api.openai.com/v1/models', {
        headers: {
            'Authorization': `Bearer ${key}`,
            'Content-Type': 'application/json'
        }
    }).then(response => response.ok).catch(() => false);
}

if (!apiKey || !apiKey.startsWith('sk-') || !username || username === 'Guest' || blacklistedUsers.includes(username) || !validateApiKey(apiKey)) {
    if (confirm('Please register or log in with a valid OpenAI API key.')) {
        window.location.href = 'https://bypasslab.site/';
    }
    codeOutput.textContent = 'Access Denied: Invalid or missing API key.';
    generalOutput.textContent = 'Access Denied: Invalid or missing API key.';
    homeworkOutput.textContent = 'Access Denied: Invalid or missing API key.';
}

welcomeUsername.textContent = username;
if (username.toLowerCase() === 'realalex') {
    adminBadge.style.display = 'inline-flex';
    adminPanelBtn.style.display = 'inline-flex';
}

signoutBtn.addEventListener('click', () => {
    localStorage.removeItem('apiKey');
    localStorage.removeItem('username');
    window.location.href = 'https://bypasslab.site/';
});

adminPanelBtn.addEventListener('click', () => {
    if (username.toLowerCase() === 'realalex') {
        window.location.href = 'https://bypasslab.site/admin-panel';
    }
});

themeToggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('light-mode');
    const isLightMode = document.body.classList.contains('light-mode');
    themeToggleBtn.querySelector('i').classList.toggle('fa-moon', !isLightMode);
    themeToggleBtn.querySelector('i').classList.toggle('fa-sun', isLightMode);
    themeToggleBtn.querySelector('span').textContent = isLightMode ? 'Dark Mode' : 'Light Mode';
    localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
});

const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'light') {
    document.body.classList.add('light-mode');
    themeToggleBtn.querySelector('i').classList.replace('fa-moon', 'fa-sun');
    themeToggleBtn.querySelector('span').textContent = 'Dark Mode';
}

const sectionTabs = document.querySelectorAll('.tab');
sectionTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        sectionTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const section = tab.dataset.section;
        codingSection.classList.toggle('active', section === 'coding');
        generalSection.classList.toggle('active', section === 'general');
        homeworkSection.classList.toggle('active', section === 'homework');
        document.querySelectorAll('.btn-primary').forEach(btn => {
            btn.style.display = btn.id === 'generalBtn' ? (section === 'general' ? 'flex' : 'none') : (btn.id === 'homeworkBtn' ? (section === 'homework' ? 'flex' : 'none') : (section === 'coding' ? 'flex' : 'none'));
        });
        document.querySelector('.language-selector').style.display = section === 'coding' ? 'flex' : 'none';
        document.querySelector('.glass-card h2').textContent = section === 'coding' ? 'Code Processing' : (section === 'general' ? 'General Query' : 'Homework Assistance');
        document.querySelector('.glass-card p').textContent = section === 'coding' ? 'Paste your code or a URL to fetch code for optimization, debugging, explanation, obfuscation, deobfuscation, improvements, or homework assistance.' : (section === 'general' ? 'Ask any question and get a detailed response.' : 'Enter your homework problem or code for a detailed solution.');
    });
});

const languagePills = document.querySelectorAll('.language-pill');
languagePills.forEach(pill => {
    pill.addEventListener('click', () => {
        languagePills.forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
    });
});

function highlightSyntax(code, lang) {
    let highlighted = code.replace(/</g, '<').replace(/>/g, '>');
    if (lang === 'javascript') {
        highlighted = highlighted.replace(/\b(function|return|const|let|var|if|else|for|while|try|catch|finally|throw|new|async|await|class|extends|super|static|yield|import|export|with|debugger)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"|'([^']*)'|(`[^`]*`)/g, '<span class="string">"$1$2$3"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/\/\/.*$/gm, '<span class="comment">$&</span>')
                                .replace(/\/\*[\s\S]*?\*\//g, '<span class="comment">$&</span>');
    } else if (lang === 'python') {
        highlighted = highlighted.replace(/\b(def|return|if|else|elif|for|while|in|try|except|finally|raise|class|lambda|with|as|yield|global|nonlocal|assert|del|pass|break|continue)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"|'([^']*)'|(\"\"\"[^\"]*\"\"\"|'''[^']*''')/g, '<span class="string">"$1$2$3"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/#.*/g, '<span class="comment">$&</span>');
    } else if (lang === 'lua') {
        highlighted = highlighted.replace(/\b(function|return|local|if|then|else|for|while|do|end|repeat|until|break|continue|goto|return)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"|'([^']*)'|(\[\[[\s\S]*?\]\])/g, '<span class="string">"$1$2$3"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/--.*/g, '<span class="comment">$&</span>');
    } else if (lang === 'ruby') {
        highlighted = highlighted.replace(/\b(def|return|if|else|elsif|for|while|do|end|class|module|begin|rescue|ensure|yield|unless|until|redo|retry|defined|alias|undef)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"|'([^']*)'|(%[qw]{([^}]+)})/g, '<span class="string">"$1$2$3"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/#.*/g, '<span class="comment">$&</span>');
    } else if (lang === 'go') {
        highlighted = highlighted.replace(/\b(func|return|if|else|for|while|switch|case|default|var|const|type|struct|interface|defer|go|select|chan|range|fallthrough|map|make|cap|len|append|copy|delete)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"|'([^']*)'/g, '<span class="string">"$1$2"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/\/\/.*/g, '<span class="comment">$&</span>')
                                .replace(/\/\*[\s\S]*?\*\//g, '<span class="comment">$&</span>');
    } else if (lang === 'java') {
        highlighted = highlighted.replace(/\b(public|private|protected|static|void|class|interface|extends|implements|if|else|for|while|do|switch|case|break|return|try|catch|finally|throw|new|synchronized|volatile|transient|strictfp|enum|instanceof|assert|package|import|native|abstract|final|interface)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"/g, '<span class="string">"$1"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/\/\/.*$/gm, '<span class="comment">$&</span>')
                                .replace(/\/\*[\s\S]*?\*\//g, '<span class="comment">$&</span>');
    } else if (lang === 'cpp') {
        highlighted = highlighted.replace(/\b(int|double|float|char|void|class|struct|if|else|for|while|do|switch|case|break|return|try|catch|throw|new|delete|const|static|public|private|protected|virtual|inline|explicit|friend|mutable|namespace|template|typename|decltype|constexpr|noexcept|override|final|alignas|alignof|thread_local|atomic|concept|requires)\b/g, '<span class="keyword">$1</span>')
                                .replace(/"([^"]*)"/g, '<span class="string">"$1"</span>')
                                .replace(/\b\d+(\.\d+)?\b/g, '<span class="number">$&</span>')
                                .replace(/[+\-*/=<>!&|%^~?:]/g, '<span class="operator">$&</span>')
                                .replace(/\b\w+(?=\s*\()/g, '<span class="function">$&</span>')
                                .replace(/\/\/.*$/gm, '<span class="comment">$&</span>')
                                .replace(/\/\*[\s\S]*?\*\//g, '<span class="comment">$&</span>');
    }
    return highlighted;
}

function hashString(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash.toString(16);
}

function checkRateLimit() {
    const now = Date.now();
    if (now - rateLimit.windowStart > rateLimit.window) {
        rateLimit.requests = 0;
        rateLimit.windowStart = now;
    }
    rateLimit.requests++;
    return rateLimit.requests <= rateLimit.limit;
}

async function fetchCodeFromUrl(url) {
    try {
        const response = await fetch(url, {
            mode: 'cors',
            headers: {
                'User-Agent': 'PrysmisAI/2.0 (https://bypasslab.site)',
                'Accept': 'text/plain, application/json, text/html, application/javascript'
            },
            redirect: 'follow',
            timeout: 10000
        });
        if (!response.ok) throw new Error(`HTTP error ${response.status}: ${response.statusText}`);
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('html')) {
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const scripts = doc.querySelectorAll('script, pre, code');
            for (const element of scripts) {
                if (element.textContent.trim()) return element.textContent.trim();
            }
            return html.match(/<script[^>]*>([\s\S]*?)<\/script>|<pre[^>]*>([\s\S]*?)<\/pre>|<code[^>]*>([\s\S]*?)<\/code>/i)?.[0] || 'Error: No code found in HTML';
        }
        return await response.text();
    } catch (error) {
        return `Error: ${error.message}. Retrying with fallback parsing...`;
    }
}

async function processCodeWithAI(code, lang, action) {
    if (!checkRateLimit()) return 'Error: Rate limit exceeded. Please wait before trying again.';

    let inputCode = code;
    const isUrl = code.match(/^https?:\/\//);
    if (isUrl) {
        inputCode = await fetchCodeFromUrl(code);
        if (inputCode.startsWith('Error')) return inputCode;
    }

    const cacheKey = hashString(`${action}-${lang}-${inputCode}`);
    if (responseCache[cacheKey]) return responseCache[cacheKey];

    let prompt = aiSettings.prompt + `\nLanguage: ${lang}\nAction: ${action}\nCode:\n${inputCode}`;
    if (action === 'obfuscate') {
        prompt += '\nObfuscate the code with state-of-the-art techniques: dynamic variable renaming with SHA-512 hashing, multi-layered control flow flattening with polymorphic code injection, string encryption using AES-256-GCM with randomized IVs, bytecode manipulation with obfuscated constants, anti-debugging hooks, and runtime integrity checks. Ensure maximum security, functionality, and performance with resistance to decompilation, reverse engineering, and dynamic analysis.';
    } else if (action === 'deobfuscate') {
        prompt += '\nDeobfuscate the code, handling advanced obfuscation (e.g., MoonSec with bytecode transformation, string encryption, control flow obfuscation, anti-debugging, packing, and virtualization). Use symbolic execution, taint tracking, decompilation, and AI-driven pattern recognition to restore readable, functional code with detailed annotations, security analysis, and original intent recovery.';
    } else if (action === 'optimize') {
        prompt += '\nOptimize the code for peak performance: reduce time complexity (e.g., O(n²) to O(n log n) with parallel algorithms, dynamic programming, or graph partitioning), eliminate redundancy with advanced static analysis, optimize memory with custom data structures (e.g., B-trees, hash maps), ensure thread safety with lock-free data structures, and provide performance benchmarks with profiling data.';
    } else if (action === 'debug') {
        prompt += '\nDebug the code with precision, identifying edge cases, logical errors, memory leaks, race conditions, deadlocks, buffer overflows, and security vulnerabilities (e.g., XSS, SQLi). Provide a corrected version with detailed fixes, best practices, unit tests, and security hardening recommendations.';
    } else if (action === 'explain') {
        prompt += '\nExplain the code comprehensively: dissect logic, data flow, control structures, and functionality. Include Big-O complexity analysis, performance bottlenecks, optimization strategies, security risks, alternative implementations with pros/cons, and real-world use cases.';
    } else if (action === 'improve') {
        prompt += '\nImprove the code: enhance readability (consistent formatting, Javadoc/ROxygen), maintainability (microservices, SOLID/DRY), efficiency (algorithmic optimization, caching, lazy loading), security (OWASP Top 10 mitigation), and scalability (distributed systems, load balancing). Provide revised code, benchmarks, and design pattern applications.';
    }

    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: aiSettings.model,
                messages: [
                    { role: 'system', content: prompt },
                    { role: 'user', content: inputCode },
                    ...conversationHistory.slice(-aiSettings.contextWindow).map(item => ({
                        role: item.action === 'general' || item.action === 'homework' ? 'user' : 'system',
                        content: item.input
                    }))
                ],
                max_tokens: aiSettings.maxTokens,
                temperature: aiSettings.temperature,
                top_p: aiSettings.topP,
                frequency_penalty: aiSettings.frequencyPenalty,
                presence_penalty: aiSettings.presencePenalty
            })
        });

        if (!response.ok) throw new Error(`API error ${response.status}: ${await response.text()}`);
        const data = await response.json();
        const result = data.choices[0].message.content.trim();
        responseCache[cacheKey] = result;
        localStorage.setItem('responseCache', JSON.stringify(responseCache));
        return result;
    } catch (error) {
        return `Error: ${error.message}. Please verify API key or connection.`;
    }
}

async function processGeneralQuery(query) {
    if (!checkRateLimit()) return 'Error: Rate limit exceeded. Please wait before trying again.';

    const cacheKey = hashString(`general-${query}`);
    if (responseCache[cacheKey]) return responseCache[cacheKey];

    const prompt = aiSettings.prompt + `\nQuery: ${query}\nProvide a precise, detailed response with clear reasoning, examples, and references. For technical queries, include best practices and standards.';
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: aiSettings.model,
                messages: [
                    { role: 'system', content: prompt },
                    { role: 'user', content: query },
                    ...conversationHistory.slice(-aiSettings.contextWindow).map(item => ({
                        role: item.action === 'general' || item.action === 'homework' ? 'user' : 'system',
                        content: item.input
                    }))
                ],
                max_tokens: aiSettings.maxTokens,
                temperature: aiSettings.temperature,
                top_p: aiSettings.topP,
                frequency_penalty: aiSettings.frequencyPenalty,
                presence_penalty: aiSettings.presencePenalty
            })
        });

        if (!response.ok) throw new Error(`API error ${response.status}: ${await response.text()}`);
        const data = await response.json();
        const result = data.choices[0].message.content.trim();
        responseCache[cacheKey] = result;
        localStorage.setItem('responseCache', JSON.stringify(responseCache));
        return result;
    } catch (error) {
        return `Error: ${error.message}. Please verify API key or connection.`;
    }
}

async function processHomeworkQuery(query) {
    if (!checkRateLimit()) return 'Error: Rate limit exceeded. Please wait before trying again.';

    const cacheKey = hashString(`homework-${query}`);
    if (responseCache[cacheKey]) return responseCache[cacheKey];

    const prompt = aiSettings.prompt + `\nQuery: ${query}\nSolve the homework problem step-by-step with mathematical proofs, algorithmic derivations, and educational insights. Include complexity analysis, alternative solutions, and references to academic resources (e.g., Knuth, Cormen).';
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: aiSettings.model,
                messages: [
                    { role: 'system', content: prompt },
                    { role: 'user', content: query },
                    ...conversationHistory.slice(-aiSettings.contextWindow).map(item => ({
                        role: item.action === 'general' || item.action === 'homework' ? 'user' : 'system',
                        content: item.input
                    }))
                ],
                max_tokens: aiSettings.maxTokens,
                temperature: aiSettings.temperature,
                top_p: aiSettings.topP,
                frequency_penalty: aiSettings.frequencyPenalty,
                presence_penalty: aiSettings.presencePenalty
            })
        });

        if (!response.ok) throw new Error(`API error ${response.status}: ${await response.text()}`);
        const data = await response.json();
        const result = data.choices[0].message.content.trim();
        responseCache[cacheKey] = result;
        localStorage.setItem('responseCache', JSON.stringify(responseCache));
            return result;
    } catch (error) {
        return `Error: ${error.message}. Please verify API key or connection.`;
    }
}

async function simulateProgress(progressBar, progressFill) {
    progressBar.classList.add('active');
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
        }
        progressFill.style.width = `${progress}%`;
    }, 30);
    return interval;
}

function setupButton(button, action, isGeneral = false, isHomework = false) {
    button.addEventListener('click', async () => {
        const input = isGeneral ? generalInput.value.trim() : (isHomework ? homeworkInput.value.trim() : codeInput.value.trim());
        if (!input) return;

        const progressBar = isGeneral ? generalProgressBar : (isHomework ? homeworkProgressBar : codeProgressBar);
        const progressFill = isGeneral ? generalProgressFill : (isHomework ? homeworkProgressFill : codeProgressFill);
        const output = isGeneral ? generalOutput : (isHomework ? homeworkOutput : codeOutput);
        const retryBtn = isGeneral ? retryGeneralBtn : (isHomework ? retryHomeworkBtn : retryCodeBtn);
        const lang = document.querySelector('.language-pill.active')?.dataset.lang || 'javascript';

        const interval = await simulateProgress(progressBar, progressFill);
        let result;
        if (isGeneral) {
            result = await processGeneralQuery(input);
        } else if (isHomework) {
            result = await processHomeworkQuery(input);
        } else {
            result = await processCodeWithAI(input, lang, action);
        }
        clearInterval(interval);
        progressBar.classList.remove('active');

        output.innerHTML = (isGeneral || isHomework) ? result : highlightSyntax(result, lang);
        retryBtn.style.display = 'inline-flex';

        conversationHistory.push({ input, action, result, timestamp: Date.now() });
        localStorage.setItem('conversationHistory', JSON.stringify(conversationHistory));
    });

    retryCodeBtn.addEventListener('click', () => button.click());
    retryGeneralBtn.addEventListener('click', () => button.click());
    retryHomeworkBtn.addEventListener('click', () => button.click());
}

setupButton(processBtn, 'optimize');
setupButton(debugBtn, 'debug');
setupButton(explainBtn, 'explain');
setupButton(obfuscateBtn, 'obfuscate');
setupButton(deobfuscateBtn, 'deobfuscate');
setupButton(improveBtn, 'improve');
setupButton(homeworkBtn, 'homework', false, true);
setupButton(generalBtn, 'general', true);

document.querySelector('.clear-btn').addEventListener('click', () => {
    codeInput.value = '';
    codeOutput.innerHTML = 'Results will appear here...';
    retryCodeBtn.style.display = 'none';
});

document.querySelector('.clear-general-btn').addEventListener('click', () => {
    generalInput.value = '';
    generalOutput.innerHTML = 'Responses will appear here...';
    retryGeneralBtn.style.display = 'none';
});

document.querySelector('.clear-homework-btn').addEventListener('click', () => {
    homeworkInput.value = '';
    homeworkOutput.innerHTML = 'Solutions will appear here...';
    retryHomeworkBtn.style.display = 'none';
});

document.querySelector('.copy-input-btn').addEventListener('click', () => {
    navigator.clipboard.writeText(codeInput.value);
});

document.querySelector('.copy-output-btn').addEventListener('click', () => {
    navigator.clipboard.writeText(codeOutput.textContent);
});

document.querySelector('.copy-general-input-btn').addEventListener('click', () => {
    navigator.clipboard.writeText(generalInput.value);
});

document.querySelector('.copy-general-output-btn').addEventListener('click', () => {
    navigator.clipboard.writeText(generalOutput.textContent);
});

document.querySelector('.copy-homework-input-btn').addEventListener('click', () => {
    navigator.clipboard.writeText(homeworkInput.value);
});

document.querySelector('.copy-homework-output-btn').addEventListener('click', () => {
    navigator.clipboard.writeText(homeworkOutput.textContent);
});

document.querySelector('.download-btn').addEventListener('click', () => {
    const blob = new Blob([codeOutput.textContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prysmis-output-${Date.now()}.txt`;
    a.click();
    URL.revokeObjectURL(url);
});

document.querySelector('.download-general-btn').addEventListener('click', () => {
    const blob = new Blob([generalOutput.textContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prysmis-general-output-${Date.now()}.txt`;
    a.click();
    URL.revokeObjectURL(url);
});

document.querySelector('.download-homework-btn').addEventListener('click', () => {
    const blob = new Blob([homeworkOutput.textContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prysmis-homework-output-${Date.now()}.txt`;
    a.click();
    URL.revokeObjectURL(url);
});
    </script>
</body>
</html>
